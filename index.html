<!DOCTYPE html>
<html lang="ru">
<head>
    <script src="https://www.gstatic.com/firebasejs/9.1.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.1/firebase-database-compat.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi Game Platform</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            overflow-x: hidden;
            background: url('https://ltdfoto.ru/images/2026/01/17/sadx.jpg') center center;
            background-size: cover;
            background-attachment: fixed;
            min-height: 100vh;
            color: white;
        }

        /* Top Status Bar with Balance - УЛУЧШЕННАЯ ПОДСВЕТКА */
        .status-bar {
            position: fixed;
            top: 45px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(145deg, 
                        rgba(99, 102, 241, 0.3), 
                        rgba(139, 92, 246, 0.2));
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 8px 16px;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.5),
                        0 0 40px rgba(99, 102, 241, 0.3),
                        inset 0 0 15px rgba(255, 255, 255, 0.1);
        }

        .balance-display {
            display: flex;
            align-items: center;
            gap: 6px;
            color: white;
            font-size: 14px;
            font-weight: 600;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        .ton-logo-white {
            width: 16px;
            height: 16px;
            filter: brightness(0) invert(1);
        }

        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0f0f0f 0%, #1a1a1a 50%, #0f0f0f 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }

        .loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loading-gif {
            width: 200px;
            height: 200px;
            object-fit: contain;
            margin-bottom: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .loading-bar-container {
            width: 300px;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .loading-bar {
            height: 100%;
            background: linear-gradient(90deg, #3b39bd, #4d4bcf, #6366f1);
            width: 0%;
            animation: loadingProgress 3s ease-out forwards;
            box-shadow: 0 0 10px rgba(59, 57, 189, 0.5);
        }

        @keyframes loadingProgress {
            0% { width: 0%; }
            100% { width: 100%; }
        }

        /* Nickname Input Modal */
        .nickname-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            backdrop-filter: blur(10px);
        }

        .nickname-modal.hidden {
            display: none;
        }

        .nickname-form {
            background: linear-gradient(145deg, #1e1e1e 0%, #2a2a2a 100%);
            border-radius: 24px;
            padding: 40px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transform: scale(0.9);
            animation: modalAppear 0.3s ease forwards;
        }

        @keyframes modalAppear {
            to {
                transform: scale(1);
            }
        }

        .nickname-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 15px;
            color: white;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nickname-subtitle {
            font-size: 16px;
            color: #ccc;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .nickname-input {
            width: 100%;
            padding: 18px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            color: white;
            font-size: 16px;
            text-align: center;
            outline: none;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }

        .nickname-input:focus {
            border-color: #6366f1;
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.3);
        }

        .nickname-input::placeholder {
            color: #888;
        }

        .nickname-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            border: none;
            border-radius: 16px;
            color: white;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 8px 24px rgba(99, 102, 241, 0.4);
        }

        .nickname-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(99, 102, 241, 0.5);
        }

        .nickname-btn:active {
            transform: translateY(0);
        }

        /* Bottom Game Navigation */
        .game-tabs {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(180deg, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0.75) 30%, rgba(0, 0, 0, 0.95) 100%);
            backdrop-filter: blur(20px);
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 20px 15px 30px;
            z-index: 999;
            box-shadow: 0 -8px 32px rgba(0, 0, 0, 0.6);
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }

        .game-tab {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 65px;
            height: 65px;
            background: rgba(255, 255, 255, 0.05);
            border: none;
            border-radius: 18px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            text-decoration: none;
            color: rgba(255, 255, 255, 0.5);
            padding: 8px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            opacity: 0.5;
        }

        .game-tab.active {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.3), rgba(139, 92, 246, 0.3));
            color: #ffffff;
            box-shadow: 0 8px 32px rgba(99, 102, 241, 0.4);
            border: 1px solid rgba(99, 102, 241, 0.5);
            transform: translateY(-3px);
            opacity: 1;
        }

        .game-tab:hover:not(.active) {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
            color: rgba(255, 255, 255, 0.8);
            opacity: 0.8;
        }

        .game-tab img {
            width: 36px;
            height: 36px;
            object-fit: contain;
            filter: brightness(0.8);
            transition: all 0.3s;
        }

        .game-tab.active img {
            filter: brightness(1) drop-shadow(0 0 12px rgba(99, 102, 241, 0.6));
            transform: scale(1.1);
        }

        .game-tab:hover img {
            filter: brightness(1);
        }

        /* Deposit tab special styling */
        .game-tab.deposit-tab {
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.2);
        }

        .game-tab.deposit-tab.active {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            border-color: #6366f1;
        }

        .deposit-plus {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, #ffffff, #f8fafc);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6366f1;
            font-size: 24px;
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            transition: all 0.3s;
        }

        .game-tab.deposit-tab.active .deposit-plus {
            background: linear-gradient(135deg, #ffffff, #f8fafc);
            color: #6366f1;
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
        }

        /* Game Container */
        .games-container {
            position: relative;
            width: 100%;
            min-height: 100vh;
            padding-bottom: 140px;
        }

        .game-wrapper {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            min-height: calc(100vh - 140px);
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 0;
            pointer-events: none;
            padding-top: 20px;
            transform: translateX(100px);
        }

        .game-wrapper.active {
            opacity: 1;
            pointer-events: auto;
            transform: translateX(0);
        }

        /* Crash Game Styles - IMPROVED LAYOUT */
        .crash-game {
            max-width: 480px;
            margin: 0 auto;
            padding: 0 16px;
        }

        .background-window {
            background: rgba(20, 20, 20, 0.95);
            border-radius: 24px;
            padding: 20px;
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .game-window {
            background: linear-gradient(145deg, rgba(30, 30, 30, 0.95), rgba(25, 25, 25, 0.95));
            border-radius: 24px;
            position: relative;
            height: 380px;
            overflow: hidden;
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.5);
            margin-bottom: 16px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* ЗВЕЗДНОЕ НЕБО */
        .game-window.starry {
            background: transparent;
            position: relative;
            overflow: hidden;
        }

        .stars-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            animation: starMove 30s linear infinite;
        }

        @keyframes starMove {
            0% { transform: translateX(0) translateY(0); }
            100% { transform: translateX(-100px) translateY(-50px); }
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s infinite alternate;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        /* CLOSE BUTTON FOR CRASH GAME */
        .crash-close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 32px;
            height: 32px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            z-index: 20;
            backdrop-filter: blur(10px);
        }

        .crash-close-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        /* Background Toggle Button */
        .background-toggle-btn {
            position: absolute;
            top: 15px;
            right: 55px;
            width: 32px;
            height: 32px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            z-index: 20;
            backdrop-filter: blur(10px);
        }

        .background-toggle-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        .history-strip {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 50px;
            background: linear-gradient(90deg, rgba(20, 20, 20, 0.9), rgba(25, 25, 25, 0.9));
            display: flex;
            align-items: center;
            padding: 0 12px;
            gap: 8px;
            overflow-x: auto;
            z-index: 15;
            scrollbar-width: none;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .history-strip::-webkit-scrollbar {
            display: none;
        }

        .history-item {
            min-width: 60px;
            height: 32px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
            font-weight: 700;
            border: 2px solid;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(10px);
            transition: all 0.3s;
        }

        .history-item.low {
            border-color: #ef4444;
            color: #ef4444;
            box-shadow: 0 0 10px rgba(239, 68, 68, 0.3);
        }

        .history-item.medium {
            border-color: #10b981;
            color: #10b981;
            box-shadow: 0 0 10px rgba(16, 185, 129, 0.3);
        }

        .history-item.high {
            border-color: #f59e0b;
            color: #f59e0b;
            box-shadow: 0 0 10px rgba(245, 158, 11, 0.3);
        }

        .grid-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2;
        }

        .red-line {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            transition: filter 0.3s;
            z-index: 5;
        }

        .red-line.break-blur {
            filter: blur(8px);
        }

        /* CENTERED ROCKET GIF - INCREASED SIZE */
        .rocket-gif {
            position: absolute;
            width: 120px;
            height: 120px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            object-fit: contain;
            pointer-events: none;
            transition: transform 0.3s ease;
            filter: drop-shadow(0 0 15px rgba(99, 102, 241, 0.5));
            transform-origin: center bottom;
            z-index: 12;
        }

        .rocket-gif.break-blur {
            filter: blur(8px);
        }

        /* EXPLOSION GIF - INCREASED SIZE */
        .explosion-gif {
            position: absolute;
            width: 120px;
            height: 120px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            object-fit: contain;
            pointer-events: none;
            z-index: 13;
        }

        /* БОЛЬШОЙ И МАССИВНЫЙ ТЕКСТ ИКС */
        .multiplier {
            position: absolute;
            top: 30%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 80px;
            font-weight: 900;
            color: white;
            text-shadow: 
                0 4px 20px rgba(0, 0, 0, 0.8),
                0 0 30px rgba(99, 102, 241, 0.5),
                0 0 40px rgba(99, 102, 241, 0.3);
            z-index: 10;
            transition: color 0.3s;
            letter-spacing: 2px;
        }

        .multiplier.crashed {
            color: #ef4444;
            text-shadow: 
                0 4px 20px rgba(0, 0, 0, 0.8),
                0 0 30px rgba(239, 68, 68, 0.5),
                0 0 40px rgba(239, 68, 68, 0.3);
        }

        .multiplier.break-blur {
            filter: blur(8px);
        }

        .countdown-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.7);
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .countdown-number {
            font-size: 120px;
            font-weight: 900;
            color: white;
            text-shadow: 0 4px 30px rgba(255, 255, 255, 0.5);
            animation: pulse 1s ease-in-out;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .bet-button, .cashout-button {
            width: 100%;
            padding: 18px;
            border: none;
            border-radius: 16px;
            color: white;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 8px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
        }

        .bet-button {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            box-shadow: 0 8px 24px rgba(99, 102, 241, 0.4);
        }

        .bet-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(99, 102, 241, 0.5);
        }

        .bet-button.hidden {
            display: none;
        }

        .cashout-button {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            box-shadow: 0 8px 24px rgba(16, 185, 129, 0.4);
            display: none;
        }

        .cashout-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(16, 185, 129, 0.5);
        }

        .cashout-button.show {
            display: block;
        }

        .players-window {
            background: linear-gradient(145deg, rgba(30, 30, 30, 0.95), rgba(25, 25, 25, 0.95));
            border-radius: 24px;
            padding: 20px;
            margin-top: 16px;
            max-height: 400px;
            overflow-y: auto;
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.6);
            scrollbar-width: none;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .players-window::-webkit-scrollbar {
            display: none;
        }

        .players-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 16px;
            border-bottom: 2px solid #6366f1;
            margin-bottom: 16px;
        }

        .players-online, .players-total {
            font-size: 14px;
            font-weight: 600;
            color: #aaa;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .player-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            background: rgba(40, 40, 40, 0.8);
            border-radius: 16px;
            margin-bottom: 8px;
            border: 2px solid transparent;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }

        .player-item.highlight {
            border-color: #f59e0b;
            box-shadow: 0 0 20px rgba(245, 158, 11, 0.4);
            background: rgba(245, 158, 11, 0.1);
        }

        .player-item.cashed-out {
            background: rgba(16, 185, 129, 0.15);
            border-color: rgba(16, 185, 129, 0.3);
        }

        .player-item.lost {
            background: rgba(239, 68, 68, 0.15);
            border-color: rgba(239, 68, 68, 0.3);
        }

        .player-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .player-name {
            font-size: 14px;
            font-weight: 500;
        }

        .player-bet {
            font-size: 13px;
            color: #888;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .player-right {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .player-cashout {
            font-size: 14px;
            font-weight: 600;
            color: #10b981;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .gift-icon {
            width: 24px;
            height: 24px;
            object-fit: contain;
            border-radius: 4px;
        }

        .footer-window {
            background: linear-gradient(145deg, rgba(30, 30, 30, 0.95), rgba(25, 25, 25, 0.95));
            border-radius: 24px;
            padding: 40px 20px;
            margin-top: 16px;
            text-align: center;
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .footer-title {
            margin-bottom: 20px;
        }

        .footer-title img {
            width: 200px;
            height: auto;
            object-fit: contain;
            filter: drop-shadow(0 0 10px rgba(99, 102, 241, 0.3));
        }

        .promo-input {
            width: 100%;
            padding: 16px;
            background: rgba(40, 40, 40, 0.8);
            border: 2px solid rgba(99, 102, 241, 0.3);
            border-radius: 12px;
            color: white;
            font-size: 16px;
            text-align: center;
            outline: none;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }

        .promo-input:focus {
            border-color: #6366f1;
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.3);
        }

        .ton-logo {
            width: 20px;
            height: 20px;
            object-fit: contain;
            filter: brightness(0) invert(1);
        }

        /* Russian Roulette Styles */
        .roulette-game {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: calc(100vh - 140px);
            position: relative;
            padding: 40px 20px;
        }

        .revolver-container {
            position: relative;
            width: 280px;
            height: 280px;
            margin-bottom: 60px;
            margin-top: 40px;
        }

        .revolver-img {
            width: 280px;
            height: auto;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
            transition: opacity 0.3s;
            filter: drop-shadow(0 0 20px rgba(99, 102, 241, 0.3));
        }

        .revolver-img.hidden {
            opacity: 0;
        }

        .animation-img {
            width: 280px;
            height: auto;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 2;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .animation-img.show {
            opacity: 1;
        }

        .bet-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-width: 400px;
            gap: 20px;
        }

        .roulette-bet-button {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
            border: none;
            padding: 16px 120px;
            font-size: 24px;
            font-weight: 600;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            max-width: 350px;
            box-shadow: 0 8px 24px rgba(99, 102, 241, 0.4);
            letter-spacing: 2px;
        }

        .roulette-bet-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(99, 102, 241, 0.5);
        }

        .roulette-bet-button:active {
            transform: translateY(0);
        }

        .roulette-bet-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .multiplier-box {
            background: linear-gradient(180deg, rgba(42, 42, 42, 0.95), rgba(26, 26, 26, 0.95));
            border-radius: 20px;
            padding: 20px;
            width: 100%;
            max-width: 350px;
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
        }

        .multiplier-image {
            width: 100%;
            height: auto;
            border-radius: 12px;
            margin-bottom: 15px;
        }

        .multiplier-text {
            color: white;
            font-size: 16px;
            font-weight: 600;
            text-align: center;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 10px;
            opacity: 0.7;
            transition: opacity 0.3s ease;
        }

        .multiplier-text:hover {
            opacity: 1;
        }

        .multiplier-text span {
            white-space: nowrap;
            background: rgba(99, 102, 241, 0.1);
            padding: 4px 8px;
            border-radius: 8px;
            border: 1px solid rgba(99, 102, 241, 0.2);
        }

        .roulette-promo-section {
            margin-top: 25px;
            padding-top: 15px;
            border-top: 1px solid rgba(99, 102, 241, 0.2);
        }

        .roulette-promo-title {
            color: #8a8a8a;
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            text-align: center;
        }

        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
            width: 100%;
            margin-top: 25px;
        }

        .action-btn {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
            border: none;
            padding: 14px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
            opacity: 0.8;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(99, 102, 241, 0.5);
            opacity: 1;
        }

        .action-btn:active {
            transform: translateY(0);
        }

        .roulette-promo-input {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border: 2px solid rgba(99, 102, 241, 0.3);
            background-color: rgba(31, 31, 31, 0.8);
            color: white;
            border-radius: 12px;
            text-align: center;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }

        .roulette-promo-input:focus {
            outline: none;
            border-color: #6366f1;
            background-color: rgba(37, 37, 37, 0.9);
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.3);
        }

        .roulette-promo-input::placeholder {
            color: #6a6a6a;
        }

        /* Slots Game Styles */
        .slots-game {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            width: 100%;
            padding: 30px 15px;
            max-width: 500px;
            margin: 0 auto;
            min-height: calc(100vh - 140px);
        }

        .slots-game-area-wrapper {
            position: relative;
            width: 100%;
            max-width: 420px;
        }

        .slots-rounded-background {
            position: absolute;
            width: 100%;
            background: linear-gradient(145deg, #0d0d0d, #1a1a1a);
            border-radius: 24px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .slot-machine-wrapper {
            position: relative;
            width: 100%;
            aspect-ratio: 500/550;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2;
        }

        .machine-bg {
            position: absolute;
            width: 100%;
            height: 100%;
            object-fit: contain;
            left: 5px;
            pointer-events: none;
            z-index: 5;
            filter: drop-shadow(0 0 20px rgba(99, 102, 241, 0.2));
        }

        .slots-container {
            position: absolute;
            display: flex;
            gap: 4%;
            width: 68%;
            top: 50%;
            left: 47%;
            transform: translate(-50%, -50%);
            z-index: 15;
            pointer-events: auto;
        }

        .slot {
            flex: 1;
            aspect-ratio: 1;
            background: linear-gradient(145deg, #222222, #1a1a1a);
            border-radius: 12px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.6), inset 0 2px 4px rgba(255, 255, 255, 0.1);
            z-index: 16;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .slot::after {
            content: '';
            position: absolute;
            right: -2%;
            top: 10%;
            bottom: 10%;
            width: 1px;
            background: rgba(255, 255, 255, 0.3);
            z-index: 20;
        }

        .slot:last-child::after {
            display: none;
        }

        .slot img {
            width: 80%;
            height: 80%;
            object-fit: contain;
            will-change: transform;
            filter: drop-shadow(0 0 15px rgba(255, 255, 255, 0.5)) drop-shadow(0 0 25px rgba(99, 102, 241, 0.4));
            transition: filter 0.3s;
        }

        .slot img.spinning {
            animation: none;
            filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.3));
        }

        @keyframes glow {
            0% {
                filter: drop-shadow(0 0 15px rgba(255, 255, 255, 0.5)) drop-shadow(0 0 25px rgba(99, 102, 241, 0.4));
            }
            100% {
                filter: drop-shadow(0 0 20px rgba(255, 255, 255, 0.7)) drop-shadow(0 0 35px rgba(99, 102, 241, 0.6));
            }
        }

        .slot img:not(.spinning) {
            animation: glow 2s ease-in-out infinite alternate;
        }

        .slots-spin-btn {
            width: 100%;
            max-width: 400px;
            padding: 16px 20px;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            border: none;
            border-radius: 16px;
            color: white;
            font-size: 16px;
            font-weight: 600;
            letter-spacing: 0.3px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 8px 24px rgba(99, 102, 241, 0.4);
            position: relative;
            z-index: 10;
            touch-action: manipulation;
        }

        .slots-spin-btn:active:not(:disabled) {
            transform: scale(0.98);
        }

        .slots-spin-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(99, 102, 241, 0.5);
        }

        .slots-spin-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .slots-bottom-panel {
            width: 100%;
            max-width: 400px;
            background: linear-gradient(145deg, rgba(26, 26, 26, 0.95), rgba(15, 15, 15, 0.95));
            border-radius: 16px;
            padding: 20px;
            z-index: 5;
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.6);
            margin-top: 10px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
        }

        .slots-panel-image {
            width: 100%;
            max-width: 180px;
            height: auto;
            margin: 0 auto 20px;
            display: block;
            border-radius: 12px;
            filter: drop-shadow(0 0 10px rgba(99, 102, 241, 0.3));
        }

        .slots-promo-input {
            width: 100%;
            padding: 14px;
            background: rgba(34, 34, 34, 0.8);
            border: 2px solid rgba(99, 102, 241, 0.3);
            border-radius: 12px;
            color: white;
            font-size: 15px;
            margin-bottom: 12px;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }

        .slots-promo-input::placeholder {
            color: #666;
        }

        .slots-promo-input:focus {
            outline: none;
            border-color: #6366f1;
            background: rgba(42, 42, 42, 0.9);
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.3);
        }

        .slots-panel-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 10px;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
            touch-action: manipulation;
        }

        .slots-panel-btn:active {
            transform: scale(0.98);
        }

        .slots-panel-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(99, 102, 241, 0.5);
        }

        .slots-panel-btn.secondary {
            background: linear-gradient(145deg, #374151, #1f2937);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        /* IMPROVED PLINKO GAME STYLES */
        .plinko-game {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            width: 100%;
            padding: 20px 15px;
            max-width: 500px;
            margin: 0 auto;
            min-height: calc(100vh - 140px);
        }

        .plinko-board-container {
            position: relative;
            width: 100%;
            max-width: 400px;
            height: 500px;
            background: linear-gradient(145deg, rgba(30, 30, 30, 0.95), rgba(25, 25, 25, 0.95));
            border-radius: 24px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.05);
            margin-bottom: 20px;
        }

        .plinko-board {
            width: 100%;
            height: 100%;
            position: relative;
            background: radial-gradient(circle at 50% 50%, rgba(99, 102, 241, 0.05), rgba(0, 0, 0, 0.2));
        }

        /* PLINKO TUBE */
        .plinko-tube {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 60px;
            background: linear-gradient(180deg, rgba(99, 102, 241, 0.8), rgba(139, 92, 246, 0.6));
            border-radius: 0 0 15px 15px;
            border: 2px solid rgba(99, 102, 241, 0.5);
            border-top: none;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
            z-index: 10;
        }

        .plinko-tube::before {
            content: '';
            position: absolute;
            top: -5px;
            left: -3px;
            right: -3px;
            height: 8px;
            background: linear-gradient(90deg, rgba(99, 102, 241, 0.6), rgba(139, 92, 246, 0.6));
            border-radius: 4px 4px 0 0;
        }

        .plinko-peg {
            position: absolute;
            width: 12px;
            height: 12px;
            background: linear-gradient(135deg, #8b5cf6, #6366f1);
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(99, 102, 241, 0.5), inset 0 2px 4px rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
        }

        .plinko-peg:hover {
            transform: scale(1.2);
            box-shadow: 0 0 15px rgba(99, 102, 241, 0.8);
        }

        /* SMALLER PLINKO BALL */
        .plinko-ball {
            position: absolute;
            width: 16px;
            height: 16px;
            background: radial-gradient(circle at 30% 30%, #ffffff, #f59e0b, #ea580c);
            border-radius: 50%;
            box-shadow: 0 0 15px rgba(245, 158, 11, 0.6), inset -2px -2px 4px rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.3);
            z-index: 100;
            transition: all 0.1s ease-out;
        }

        .plinko-buckets {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 60px;
            display: flex;
            justify-content: space-between;
            align-items: stretch;
            padding: 0 10px;
            background: linear-gradient(180deg, transparent, rgba(0, 0, 0, 0.3));
        }

        .plinko-bucket {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 1px;
            background: linear-gradient(145deg, rgba(40, 40, 40, 0.9), rgba(30, 30, 30, 0.9));
            border-radius: 8px 8px 0 0;
            font-size: 11px;
            font-weight: 700;
            color: white;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }

        .plinko-bucket.high-multiplier {
            background: linear-gradient(145deg, rgba(245, 158, 11, 0.3), rgba(217, 119, 6, 0.3));
            border-color: rgba(245, 158, 11, 0.5);
            color: #fbbf24;
            box-shadow: 0 0 20px rgba(245, 158, 11, 0.3);
        }

        .plinko-bucket.medium-multiplier {
            background: linear-gradient(145deg, rgba(16, 185, 129, 0.3), rgba(5, 150, 105, 0.3));
            border-color: rgba(16, 185, 129, 0.5);
            color: #34d399;
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.3);
        }

        .plinko-bucket.low-multiplier {
            background: linear-gradient(145deg, rgba(239, 68, 68, 0.3), rgba(185, 28, 28, 0.3));
            border-color: rgba(239, 68, 68, 0.5);
            color: #f87171;
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.3);
        }

        .plinko-bucket.hit {
            animation: bucketHit 0.5s ease-out;
        }

        @keyframes bucketHit {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); box-shadow: 0 0 30px rgba(99, 102, 241, 0.8); }
            100% { transform: scale(1); }
        }

        .plinko-controls {
            width: 100%;
            max-width: 400px;
            background: linear-gradient(145deg, rgba(26, 26, 26, 0.95), rgba(15, 15, 15, 0.95));
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
        }

        .plinko-bet-section {
            margin-bottom: 20px;
        }

        .plinko-input-label {
            color: #8a8a8a;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .plinko-bet-input {
            width: 100%;
            padding: 14px;
            background: rgba(34, 34, 34, 0.8);
            border: 2px solid rgba(99, 102, 241, 0.3);
            border-radius: 12px;
            color: white;
            font-size: 16px;
            text-align: center;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
            margin-bottom: 12px;
        }

        .plinko-bet-input:focus {
            outline: none;
            border-color: #6366f1;
            background: rgba(42, 42, 42, 0.9);
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.3);
        }

        .plinko-bet-input::placeholder {
            color: #666;
        }

        .plinko-quick-bets {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
        }

        .plinko-quick-bet {
            flex: 1;
            padding: 10px;
            background: rgba(42, 42, 42, 0.8);
            border: 2px solid rgba(99, 102, 241, 0.3);
            border-radius: 10px;
            color: white;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }

        .plinko-quick-bet:hover {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            border-color: #6366f1;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
        }

        .plinko-drop-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 8px 24px rgba(99, 102, 241, 0.4);
            letter-spacing: 1px;
        }

        .plinko-drop-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(99, 102, 241, 0.5);
        }

        .plinko-drop-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* PLINKO RECENT BETS - ТОЛЬКО ОДНА СТАВКА БЕЗ НИКОВ */
        .plinko-recent-bets {
            width: 100%;
            max-width: 400px;
            background: linear-gradient(145deg, rgba(26, 26, 26, 0.95), rgba(15, 15, 15, 0.95));
            border-radius: 16px;
            padding: 12px;
            margin-bottom: 20px;
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            min-height: 60px;
        }

        .recent-bets-title {
            font-size: 14px;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 8px;
            text-align: center;
            padding-bottom: 4px;
            border-bottom: 1px solid rgba(99, 102, 241, 0.3);
        }

        .single-bet-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 12px;
            background: rgba(40, 40, 40, 0.6);
            border-radius: 8px;
            font-size: 13px;
            transition: all 0.3s;
            border: 1px solid rgba(99, 102, 241, 0.2);
        }

        .single-bet-item:hover {
            background: rgba(50, 50, 50, 0.8);
        }

        .single-bet-details {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
        }

        .single-bet-amount {
            color: #888;
        }

        .single-bet-result {
            color: #10b981;
            font-weight: 600;
        }

        .single-bet-result.lose {
            color: #ef4444;
        }

        .plinko-stats {
            margin-top: 20px;
            padding: 15px;
            background: rgba(30, 30, 30, 0.8);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .plinko-stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            color: #ccc;
            font-size: 14px;
        }

        .plinko-stat-row:last-child {
            margin-bottom: 0;
        }

        .plinko-stat-value {
            color: #10b981;
            font-weight: 600;
        }

        /* NEW DEPOSIT GAME STYLES WITH BALANCE AND PROFILE */
        .deposit-game {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: calc(100vh - 140px);
            padding: 40px 20px;
            gap: 20px;
        }

        /* BALANCE AND PROFILE WINDOW */
        .balance-profile-window {
            background: linear-gradient(145deg, rgba(30, 30, 30, 0.95), rgba(25, 25, 25, 0.95));
            border-radius: 24px;
            padding: 30px;
            max-width: 400px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            text-align: center;
            margin-bottom: 20px;
        }

        .profile-section {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(99, 102, 241, 0.3);
        }

        .profile-avatar {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 28px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 24px rgba(99, 102, 241, 0.4);
        }

        .profile-info {
            text-align: left;
        }

        .profile-username {
            font-size: 20px;
            font-weight: 700;
            color: white;
            margin-bottom: 5px;
        }

        .profile-id {
            font-size: 12px;
            color: #888;
            opacity: 0.7;
        }

        .balance-section {
            margin-bottom: 20px;
        }

        .balance-title {
            color: #888;
            font-size: 14px;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .balance-amount {
            font-size: 36px;
            font-weight: 900;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .balance-ton-icon {
            width: 32px;
            height: 32px;
            filter: brightness(0) invert(1);
        }

        /* ONLINE SECTION IN PROFILE */
        .online-section {
            margin-bottom: 30px;
            padding: 15px;
            background: rgba(99, 102, 241, 0.1);
            border-radius: 16px;
            border: 1px solid rgba(99, 102, 241, 0.3);
        }

        .online-title {
            color: #888;
            font-size: 12px;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .online-count {
            font-size: 24px;
            font-weight: 700;
            color: #10b981;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .online-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #10b981;
            animation: pulse-green 2s infinite;
        }

        @keyframes pulse-green {
            0%, 100% { opacity: 1; box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.8); }
            50% { opacity: 0.7; box-shadow: 0 0 0 4px rgba(16, 185, 129, 0); }
        }

        .profile-actions {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .profile-action-btn {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 8px 24px rgba(99, 102, 241, 0.3);
        }

        .profile-action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(99, 102, 241, 0.5);
        }

        .profile-action-btn.secondary {
            background: linear-gradient(145deg, #374151, #1f2937);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .profile-action-btn.withdraw {
            background: linear-gradient(135deg, #10b981, #059669);
            box-shadow: 0 8px 24px rgba(16, 185, 129, 0.3);
        }

        /* QR CODE SECTION */
        .qr-section {
            background: linear-gradient(145deg, rgba(30, 30, 30, 0.95), rgba(25, 25, 25, 0.95));
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            max-width: 400px;
            width: 100%;
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .qr-code {
            width: 80px;
            height: 80px;
            border-radius: 12px;
            object-fit: cover;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            transition: all 0.3s;
        }

        .qr-code:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 16px rgba(99, 102, 241, 0.3);
        }

        .qr-text {
            flex: 1;
            color: white;
            font-size: 14px;
            line-height: 1.5;
        }

        .qr-text strong {
            color: #6366f1;
            font-weight: 600;
        }

        /* QR FULLSCREEN MODAL */
        .qr-fullscreen-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            backdrop-filter: blur(10px);
            flex-direction: column;
            gap: 20px;
            padding: 40px;
            text-align: center;
        }

        .qr-fullscreen-modal.show {
            display: flex;
        }

        .qr-fullscreen-image {
            max-width: 300px;
            max-height: 300px;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
        }

        .qr-address-text {
            background: rgba(30, 30, 30, 0.9);
            padding: 16px 20px;
            border-radius: 12px;
            color: white;
            font-family: monospace;
            font-size: 16px;
            word-break: break-all;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid rgba(99, 102, 241, 0.3);
            max-width: 100%;
            user-select: all;
        }

        .qr-address-text:hover {
            background: rgba(99, 102, 241, 0.1);
            border-color: #6366f1;
        }

        .qr-close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .qr-close-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        .deposit-container {
            background: linear-gradient(145deg, rgba(30, 30, 30, 0.95), rgba(25, 25, 25, 0.95));
            border-radius: 24px;
            padding: 30px;
            max-width: 400px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .deposit-title {
            font-size: 24px;
            font-weight: 700;
            text-align: center;
            margin-bottom: 30px;
            color: white;
            text-shadow: 0 2px 8px rgba(255, 255, 255, 0.1);
        }

        .deposit-methods {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .deposit-method {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
            border: none;
            padding: 16px 20px;
            border-radius: 16px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 8px 24px rgba(99, 102, 241, 0.3);
        }

        .deposit-method:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(99, 102, 241, 0.5);
        }

        .deposit-method:active {
            transform: translateY(0);
        }

        .promo-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid rgba(99, 102, 241, 0.2);
        }

        .promo-title {
            color: #8a8a8a;
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            text-align: center;
        }

        .promo-input-main {
            width: 100%;
            padding: 14px;
            background: rgba(34, 34, 34, 0.8);
            border: 2px solid rgba(99, 102, 241, 0.3);
            border-radius: 12px;
            color: white;
            font-size: 15px;
            text-align: center;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }

        .promo-input-main::placeholder {
            color: #666;
        }

        .promo-input-main:focus {
            outline: none;
            border-color: #6366f1;
            background: rgba(42, 42, 42, 0.9);
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.3);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: linear-gradient(145deg, rgba(20, 20, 20, 0.98), rgba(15, 15, 15, 0.98));
            border-radius: 24px 24px 0 0;
            padding: 24px;
            z-index: 2000;
            animation: slideUp 0.3s ease;
            box-shadow: 0 -20px 60px rgba(0, 0, 0, 0.8);
            max-height: 80vh;
            overflow-y: auto;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .modal.show {
            display: block;
        }

        .modal-handle {
            width: 40px;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            margin: 0 auto 20px;
        }

        @keyframes slideUp {
            from {
                transform: translateY(100%);
            }
            to {
                transform: translateY(0);
            }
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
            text-align: center;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .modal-input {
            width: 100%;
            padding: 16px;
            background: rgba(30, 30, 30, 0.8);
            border: 2px solid rgba(99, 102, 241, 0.3);
            border-radius: 12px;
            color: white;
            font-size: 16px;
            outline: none;
            margin-bottom: 12px;
            backdrop-filter: blur(10px);
            transition: all 0.3s;
        }

        .modal-input:focus {
            border-color: #6366f1;
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.3);
        }

        .modal-button {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 12px;
            transition: all 0.3s;
            box-shadow: 0 8px 24px rgba(99, 102, 241, 0.4);
        }

        .modal-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(99, 102, 241, 0.5);
        }

        .tab-container {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
        }

        .tab {
            flex: 1;
            padding: 12px;
            background: rgba(30, 30, 30, 0.8);
            border: none;
            border-radius: 12px;
            color: rgba(255, 255, 255, 0.6);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }

        .tab.active {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
        }

        .toggle-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            background: rgba(30, 30, 30, 0.8);
            border-radius: 12px;
            margin-bottom: 12px;
            backdrop-filter: blur(10px);
        }

        .toggle {
            width: 50px;
            height: 28px;
            background: rgba(60, 60, 60, 0.8);
            border-radius: 14px;
            position: relative;
            cursor: pointer;
            transition: background 0.3s;
        }

        .toggle.active {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
        }

        .toggle-slider {
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 12px;
            position: absolute;
            top: 2px;
            left: 2px;
            transition: left 0.3s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .toggle.active .toggle-slider {
            left: 24px;
        }

        .inventory-placeholder {
            padding: 40px 20px;
            text-align: center;
            color: #888;
            font-size: 14px;
            line-height: 1.6;
            background: rgba(30, 30, 30, 0.5);
            border-radius: 12px;
            border: 2px dashed rgba(99, 102, 241, 0.3);
        }

        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .gift-item {
            background: rgba(30, 30, 30, 0.8);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }

        .gift-item:hover {
            border-color: rgba(99, 102, 241, 0.5);
            background: rgba(99, 102, 241, 0.1);
        }

        .gift-item.selected {
            border-color: #6366f1;
            background: rgba(99, 102, 241, 0.2);
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.3);
        }

        .gift-item img {
            width: 60px;
            height: 60px;
            object-fit: contain;
            margin-bottom: 8px;
            border-radius: 8px;
        }

        .gift-value {
            font-size: 13px;
            font-weight: 600;
            color: #10b981;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }

        .overlay-dim {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1500;
            display: none;
            backdrop-filter: blur(5px);
        }

        .overlay-dim.show {
            display: block;
        }

        /* Roulette specific overlay */
        .roulette-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 500;
            display: none;
            pointer-events: none;
            backdrop-filter: blur(5px);
        }

        .roulette-overlay.show {
            display: block;
            pointer-events: auto;
        }

        /* Result Modal */
        .result-modal {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: linear-gradient(145deg, rgba(20, 20, 20, 0.98), rgba(15, 15, 15, 0.98));
            border-radius: 24px 24px 0 0;
            padding: 40px 24px;
            z-index: 3000;
            text-align: center;
            animation: slideUp 0.3s ease;
            box-shadow: 0 -20px 60px rgba(0, 0, 0, 0.8);
            display: none;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .result-modal.show {
            display: block;
        }

        .result-modal-handle {
            width: 40px;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            margin: 0 auto 20px;
        }

        .result-image {
            width: 120px;
            height: 120px;
            object-fit: contain;
            margin: 0 auto 20px;
            border-radius: 12px;
        }

        .result-amount {
            font-size: 36px;
            font-weight: 900;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .result-amount.win {
            color: #10b981;
        }

        .result-amount.lose {
            color: #ef4444;
        }

        /* Payment Methods */
        .payment-methods {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .payment-method {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 8px 24px rgba(99, 102, 241, 0.4);
        }

        .payment-method:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(99, 102, 241, 0.5);
        }

        .amount-section {
            margin: 20px 0;
        }

        .currency-toggle {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .currency-btn {
            flex: 1;
            padding: 8px;
            background: rgba(30, 30, 30, 0.8);
            border: 2px solid rgba(99, 102, 241, 0.3);
            border-radius: 8px;
            color: white;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }

        .currency-btn.active {
            border-color: #6366f1;
            background: rgba(99, 102, 241, 0.2);
            box-shadow: 0 0 15px rgba(99, 102, 241, 0.3);
        }

        .conversion-info {
            font-size: 14px;
            color: #888;
            text-align: center;
            margin-top: 8px;
        }

        .payment-info {
            background: rgba(30, 30, 30, 0.8);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .payment-detail {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .payment-detail:last-child {
            margin-bottom: 0;
        }

        .detail-label {
            color: #888;
            font-size: 14px;
        }

        .detail-value {
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: color 0.2s;
        }

        .detail-value:hover {
            color: #6366f1;
        }

        .payment-note {
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin: 20px 0;
            font-size: 14px;
            color: white;
            text-align: center;
            line-height: 1.5;
            backdrop-filter: blur(10px);
        }

        .continue-timer {
            margin-top: 20px;
            padding: 16px;
            background: #666;
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: not-allowed;
            opacity: 0.5;
            transition: all 0.3s;
            width: 100%;
        }

        .continue-timer.ready {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            cursor: pointer;
            opacity: 1;
            box-shadow: 0 8px 24px rgba(99, 102, 241, 0.4);
        }

        .continue-timer.ready:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(99, 102, 241, 0.5);
        }

        /* Bet Panel for Russian Roulette */
        .bet-panel {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(180deg, rgba(42, 42, 42, 0.95), rgba(26, 26, 26, 0.95));
            border-radius: 30px 30px 0 0;
            padding: 25px 20px 40px;
            width: 100%;
            max-width: 100%;
            transform: translateY(100%);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 600;
            box-shadow: 0 -20px 60px rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .bet-panel.show {
            transform: translateY(0);
        }

        .handle-bar {
            width: 40px;
            height: 4px;
            background-color: #4a4a4a;
            border-radius: 2px;
            margin: 0 auto 25px;
            cursor: pointer;
        }

        .panel-section {
            margin-bottom: 25px;
        }

        .section-title {
            color: #8a8a8a;
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .bet-input {
            width: 100%;
            padding: 16px;
            font-size: 18px;
            border: 2px solid rgba(99, 102, 241, 0.3);
            background-color: rgba(31, 31, 31, 0.8);
            color: white;
            border-radius: 16px;
            text-align: center;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }

        .bet-input:focus {
            outline: none;
            border-color: #6366f1;
            background-color: rgba(37, 37, 37, 0.9);
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.3);
        }

        .bet-input::placeholder {
            color: #6a6a6a;
        }

        .bet-amount-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .amount-btn {
            background-color: rgba(42, 42, 42, 0.8);
            color: white;
            border: 2px solid rgba(99, 102, 241, 0.3);
            padding: 12px 0;
            font-size: 16px;
            font-weight: 600;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
            backdrop-filter: blur(10px);
        }

        .amount-btn:hover {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            border-color: #6366f1;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
        }

        .amount-btn:active {
            transform: translateY(0);
        }

        .separator {
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(99, 102, 241, 0.3), transparent);
            margin: 20px 0;
        }

        .bullets-selector {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        .bullet-btn {
            background-color: rgba(42, 42, 42, 0.8);
            color: white;
            border: 2px solid rgba(99, 102, 241, 0.3);
            padding: 14px 0;
            font-size: 20px;
            font-weight: bold;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
            min-width: 70px;
            backdrop-filter: blur(10px);
        }

        .bullet-btn.active {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            border-color: #6366f1;
            color: white;
            box-shadow: 0 8px 24px rgba(99, 102, 241, 0.4);
        }

        .bullet-btn:hover {
            transform: translateY(-2px);
            border-color: #6366f1;
        }

        .bullet-btn:active {
            transform: translateY(0);
        }

        .panel-bet-button {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
            border: none;
            padding: 18px 60px;
            font-size: 24px;
            font-weight: 600;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            margin-top: 20px;
            box-shadow: 0 8px 24px rgba(99, 102, 241, 0.4);
            letter-spacing: 2px;
        }

        .panel-bet-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(99, 102, 241, 0.5);
        }

        .panel-bet-button:active {
            transform: translateY(0);
        }

        .panel-bet-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Withdraw Modal */
        .withdraw-modal {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: linear-gradient(145deg, rgba(20, 20, 20, 0.98), rgba(15, 15, 15, 0.98));
            border-radius: 24px 24px 0 0;
            padding: 24px;
            z-index: 2000;
            animation: slideUp 0.3s ease;
            box-shadow: 0 -20px 60px rgba(0, 0, 0, 0.8);
            max-height: 80vh;
            overflow-y: auto;
            display: none;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .withdraw-modal.show {
            display: block;
        }

        .withdraw-warning {
            background: rgba(239, 68, 68, 0.1);
            border: 2px solid rgba(239, 68, 68, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin: 20px 0;
            text-align: center;
            color: #f87171;
            font-size: 14px;
            line-height: 1.5;
            font-weight: 600;
        }

        /* Balance Display in Bet Modals */
        .bet-balance-display {
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 12px;
            padding: 12px 16px;
            margin-bottom: 15px;
            text-align: center;
            font-size: 14px;
            color: white;
        }

        .bet-balance-amount {
            font-weight: 600;
            color: #6366f1;
        }

        /* History Modal */
        .history-modal {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: linear-gradient(145deg, rgba(20, 20, 20, 0.98), rgba(15, 15, 15, 0.98));
            border-radius: 24px 24px 0 0;
            padding: 24px;
            z-index: 2000;
            animation: slideUp 0.3s ease;
            box-shadow: 0 -20px 60px rgba(0, 0, 0, 0.8);
            max-height: 80vh;
            overflow-y: auto;
            display: none;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .history-modal.show {
            display: block;
        }

        .history-list {
            max-height: 60vh;
            overflow-y: auto;
        }

        .history-item-entry {
            background: rgba(30, 30, 30, 0.8);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .history-info {
            display: flex;
            flex-direction: column;
        }

        .history-date {
            font-size: 12px;
            color: #888;
            margin-bottom: 4px;
        }

        .history-description {
            font-size: 14px;
            color: white;
            font-weight: 600;
        }

        .history-amount {
            font-size: 16px;
            font-weight: 700;
            color: #10b981;
        }

        /* Responsive */
        @media (max-width: 480px) {
            .status-bar {
                top: 40px;
                padding: 6px 12px;
            }

            .balance-display {
                font-size: 12px;
                gap: 4px;
            }

            .ton-logo-white {
                width: 14px;
                height: 14px;
            }

            .game-tabs {
                padding: 15px 8px 25px;
            }

            .game-tab {
                width: 60px;
                height: 60px;
            }

            .game-tab img {
                width: 32px;
                height: 32px;
            }

            .deposit-plus {
                width: 32px;
                height: 32px;
                font-size: 20px;
            }

            .games-container {
                padding-bottom: 120px;
            }

            .game-wrapper {
                min-height: calc(100vh - 120px);
            }

            .plinko-board-container {
                height: 400px;
            }

            .qr-section {
                flex-direction: column;
                text-align: center;
            }

            .qr-code {
                align-self: center;
            }

            .balance-profile-window {
                padding: 20px;
            }

            .profile-section {
                flex-direction: column;
                gap: 10px;
            }

            .profile-info {
                text-align: center;
            }
        }

        /* Smooth scroll */
        html {
            scroll-behavior: smooth;
        }

        /* Better scrollbars */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #8b5cf6, #6366f1);
        }

        /* Loading animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.6s ease forwards;
        }

        /* Enhanced line for crash game */
        .crash-line-enhanced {
            filter: drop-shadow(0 0 8px #10b981) 
                    drop-shadow(0 0 16px #10b981) 
                    drop-shadow(0 0 24px #10b981);
            stroke-width: 6;
        }

        /* Clickable elements vibration class */
        .vibrate-click {
            cursor: pointer;
        }

        .vibrate-click:active {
            transform: scale(0.98);
        }
    </style>
</head>

<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <img class="loading-gif" id="loadingGif" src="https://i.postimg.cc/MGF2ML5M/ezgif-78c292e779aaf7ba.gif" alt="Loading">
        <div class="loading-bar-container">
            <div class="loading-bar"></div>
        </div>
    </div>

    <!-- Status Bar with Balance -->
    <div class="status-bar" id="statusBar">
        <div class="balance-display">
            <span id="statusBalance">0.10</span>
            <img src="https://ton.app/assets/images/what-is-ton/ton-logo.png" alt="TON" class="ton-logo-white">
        </div>
        <div id="ton-connect-button" style="margin-top: 5px;"></div>
    </div>

    <!-- Nickname Input Modal -->
    <div class="nickname-modal" id="nicknameModal">
        <div class="nickname-form">
            <h1 class="nickname-title">🎮 Добро пожаловать!</h1>
            <p class="nickname-subtitle">Введите ваш никнейм для входа в игру</p>
            <input type="text" class="nickname-input" id="nicknameInput" placeholder="Введите ваш никнейм" maxlength="20" required>
            <button class="nickname-btn vibrate-click" id="nicknameSubmit">Начать игру</button>
        </div>
    </div>

    <!-- QR Fullscreen Modal -->
    <div class="qr-fullscreen-modal" id="qrFullscreenModal">
        <button class="qr-close-btn vibrate-click" id="qrCloseBtn">×</button>
        <img class="qr-fullscreen-image" id="qrFullscreenImage" src="https://i.postimg.cc/PfgPFs1t/bc912fe88217e15ea3cda8e22366054e.jpg" alt="QR Code">
        <div class="qr-address-text vibrate-click" id="qrAddressText">UQDPQnBYHJjSg3LbdxdSQpenG4EMF3In46ccK9mTGnilzkYS</div>
    </div>

    <!-- Games Container -->
    <div class="games-container">
        <!-- Crash Game -->
        <div class="game-wrapper active" id="crashGame">
            <div class="crash-game fade-in">
                <div class="background-window">
                    <div class="game-window starry" id="gameWindow">
                        <div class="stars-container" id="starsContainer"></div>
                        <div class="history-strip" id="historyStrip"></div>
                        <canvas class="grid-canvas" id="gridCanvas"></canvas>
                        <svg class="red-line" id="redLine" width="100%" height="100%" viewBox="0 0 480 380" preserveAspectRatio="none">
                            <path id="linePath" d="" stroke="#10b981" stroke-width="6" fill="none" vector-effect="non-scaling-stroke" class="crash-line-enhanced" />
                        </svg>
                        <!-- ROCKET GIF -->
                        <img class="rocket-gif" id="rocket" src="https://i.postimg.cc/MZdRGKfz/Animated-Ag-ADyxs-AAte-Jk-Us11.gif" alt="Rocket">
                        <div class="multiplier" id="multiplier">1.00x</div>
                        <!-- BACKGROUND TOGGLE BUTTON -->
                        <button class="background-toggle-btn vibrate-click" id="backgroundToggleBtn">✦</button>
                        <!-- CLOSE BUTTON -->
                        <button class="crash-close-btn vibrate-click" id="crashCloseBtn">×</button>
                        <div class="countdown-overlay" id="countdown" style="display: none;">
                            <div class="countdown-number" id="countdownNumber">5</div>
                        </div>
                    </div>
                    <button class="bet-button vibrate-click" id="betButton" onclick="openBetModal()">Поставить</button>
                    <button class="cashout-button vibrate-click" id="cashoutBtn" onclick="cashOut()">Забрать</button>
                    <div class="players-window" id="playersWindow">
                        <div class="players-header">
                            <div class="players-total">Сумма: <span id="totalAmount">0.00</span> <img src="https://ton.app/assets/images/what-is-ton/ton-logo.png" alt="TON" class="ton-logo"></div>
                        </div>
                        <div id="playersList"></div>
                    </div>
                    <div class="footer-window">
                        <div class="footer-title">
                            <img src="https://i.postimg.cc/XN9jNVR8/Snimok-ekrana-2025-11-24-200044-Photoroom.png" alt="TonCrash">
                        </div>
                        <input type="text" class="promo-input vibrate-click" id="promoInput" placeholder="Введите промокод">
                    </div>
                </div>
            </div>
        </div>

        <!-- Russian Roulette Game -->
        <div class="game-wrapper" id="rouletteGame">
            <div class="roulette-game fade-in">
                <div class="revolver-container">
                    <img src="https://i.postimg.cc/tR59kxY1/Snimok-ekrana-2025-11-20-221451-Photoroom.png" alt="Revolver" class="revolver-img" id="revolverImg">
                    <img src="/placeholder.svg" alt="Animation" class="animation-img" id="animationImg">
                </div>
                <div class="bet-section">
                    <button class="roulette-bet-button vibrate-click" id="rouletteBetButton">BET</button>
                    <div class="multiplier-box">
                        <img src="https://i.postimg.cc/bwrCKTqd/fdsdf.png" alt="Multipliers" class="multiplier-image">
                        <div class="multiplier-text">
                            <span>1 пуля - x1.2</span>
                            <span>2 пули - x1.6</span>
                            <span>3 пули - x2.1</span>
                        </div>
                        <div class="roulette-promo-section">
                            <div class="roulette-promo-title">Промокод</div>
                            <input type="text" class="roulette-promo-input vibrate-click" id="roulettePromoInput" placeholder="Введите промокод">
                        </div>
                        <div class="action-buttons">
                            <button class="action-btn vibrate-click" id="rouletteDepositBtn">Пополнить</button>
                            <button class="action-btn vibrate-click" id="rouletteInventoryBtn">Инвентарь</button>
                            <button class="action-btn vibrate-click" id="rouletteWithdrawBtn">Вывод</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slots Game -->
        <div class="game-wrapper" id="slotsGame">
            <div class="slots-game fade-in">
                <div class="slots-game-area-wrapper">
                    <div class="slots-rounded-background" id="slotsRoundedBg"></div>
                    <div class="slot-machine-wrapper">
                        <img src="https://i.postimg.cc/rpDVPkQZ/khl.png" alt="Slot Machine" class="machine-bg">
                        <div class="slots-container">
                            <div class="slot" id="slot1">
                                <img src="https://i.postimg.cc/hG4Bkqsr/ezgif-1f925d4c46d6c39d.gif" alt="Symbol 1">
                            </div>
                            <div class="slot" id="slot2">
                                <img src="https://i.postimg.cc/MTNJffw6/ezgif-7fd325552fba26bd.gif" alt="Symbol 2">
                            </div>
                            <div class="slot" id="slot3">
                                <img src="https://i.postimg.cc/BQWGqFNk/ezgif-7dd4ef2897523534.gif" alt="Symbol 3">
                            </div>
                        </div>
                    </div>
                    <button class="slots-spin-btn vibrate-click" id="slotsSpin">SPIN</button>
                </div>
                <div class="slots-bottom-panel">
                    <img src="https://i.postimg.cc/DzvjKJRg/sdfvvd.png" alt="Panel" class="slots-panel-image">
                    <input type="text" class="slots-promo-input vibrate-click" id="slotsPromoCode" placeholder="Введите промокод">
                    <button class="slots-panel-btn vibrate-click" id="slotsDepositBtn">Пополнить</button>
                    <button class="slots-panel-btn vibrate-click" id="slotsWithdrawBtn">Вывод</button>
                    <button class="slots-panel-btn secondary vibrate-click" id="slotsSupportBtn">Тех. Поддержка</button>
                </div>
            </div>
        </div>

        <!-- Plinko Game -->
        <div class="game-wrapper" id="plinkoGame">
            <div class="plinko-game fade-in">
                <div class="plinko-board-container">
                    <div class="plinko-board" id="plinkoBoard">
                        <!-- TUBE -->
                        <div class="plinko-tube"></div>
                        <div class="plinko-buckets" id="plinkoBuckets"></div>
                    </div>
                </div>
                <!-- RECENT BETS SECTION - ТОЛЬКО ОДНА СТАВКА БЕЗ НИКОВ -->
                <div class="plinko-recent-bets" id="plinkoRecentBets">
                    <div class="recent-bets-title">Последняя ставка</div>
                    <div id="recentBetsList">
                        <!-- Будет заполняться одной ставкой без ников -->
                    </div>
                </div>
                <div class="plinko-controls">
                    <div class="plinko-bet-section">
                        <div class="plinko-input-label">Ставка</div>
                        <div class="tab-container">
                            <button class="tab active vibrate-click" id="plinkoTonTab" onclick="switchPlinkoTab('ton')">TON</button>
                            <button class="tab vibrate-click" id="plinkoInventoryTab" onclick="switchPlinkoTab('inventory')">Инвентарь</button>
                        </div>
                        <div id="plinkoTonContent">
                            <input type="number" class="plinko-bet-input vibrate-click" id="plinkoBetInput" placeholder="Введите ставку" step="0.01" min="0.01" max="50">
                            <div class="plinko-quick-bets">
                                <button class="plinko-quick-bet vibrate-click" data-amount="0.1">0.1</button>
                                <button class="plinko-quick-bet vibrate-click" data-amount="0.5">0.5</button>
                                <button class="plinko-quick-bet vibrate-click" data-amount="1">1.0</button>
                                <button class="plinko-quick-bet vibrate-click" data-amount="all">ALL</button>
                            </div>
                        </div>
                        <div id="plinkoInventoryContent" style="display: none;">
                            <div class="inventory-placeholder" id="plinkoInventoryPlaceholder">
                                Отправьте любой подарок/nft @suphiex<br>и он отобразится в профиле
                            </div>
                            <div class="inventory-grid" id="plinkoInventoryGrid" style="display: none;"></div>
                        </div>
                    </div>
                    <button class="plinko-drop-btn vibrate-click" id="plinkoDropBtn">БРОСИТЬ ШАРИК</button>
                    <div class="plinko-stats">
                        <div class="plinko-stat-row">
                            <span>Игр сыграно:</span>
                            <span class="plinko-stat-value" id="plinkoGamesPlayed">0</span>
                        </div>
                        <div class="plinko-stat-row">
                            <span>Общий выигрыш:</span>
                            <span class="plinko-stat-value" id="plinkoTotalWin">0.00 TON</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- NEW DEPOSIT GAME WITH BALANCE AND PROFILE -->
        <div class="game-wrapper" id="depositGame">
            <div class="deposit-game fade-in">
                <!-- BALANCE AND PROFILE WINDOW -->
                <div class="balance-profile-window">
                    <div class="profile-section">
                        <div class="profile-avatar">
                            <span id="profileIcon">👤</span>
                        </div>
                        <div class="profile-info">
                            <div class="profile-username" id="profileUsername">@username</div>
                            <div class="profile-id">ID: #<span id="profileId">123456</span></div>
                        </div>
                    </div>
                    
                    <div class="balance-section">
                        <div class="balance-title">Ваш баланс</div>
                        <div class="balance-amount">
                            <span id="mainBalance">0.10</span>
                            <img src="https://ton.app/assets/images/what-is-ton/ton-logo.png" alt="TON" class="balance-ton-icon">
                        </div>
                    </div>

                    <!-- ONLINE SECTION -->
                    <div class="online-section">
                        <div class="online-title">Онлайн игроков</div>
                        <div class="online-count">
                            <div class="online-indicator"></div>
                            <span id="onlineCount">125</span>
                        </div>
                    </div>

                    <div class="profile-actions">
                        <button class="profile-action-btn vibrate-click" id="profileDepositBtn">Пополнить баланс</button>
                        <button class="profile-action-btn withdraw vibrate-click" id="profileWithdrawBtn">Вывод средств</button>
                        <button class="profile-action-btn secondary vibrate-click" id="profileSupportBtn">Тех. Поддержка</button>
                    </div>
                </div>

                <!-- QR CODE SECTION -->
                <div class="qr-section">
                    <img class="qr-code vibrate-click" id="qrCodeImage" src="https://i.postimg.cc/PfgPFs1t/bc912fe88217e15ea3cda8e22366054e.jpg" alt="QR Code">
                    <div class="qr-text">
                        <strong>Ваш TON адрес для пополнения</strong><br>
                        Минимальная сумма: <strong>1.00 TON</strong>
                    </div>
                </div>
                
                <div class="deposit-container">
                    <h1 class="deposit-title">Пополнение</h1>
                    <div class="deposit-methods">
                        <button class="deposit-method vibrate-click" id="cryptoBotBtn">Пополнить через CryptoBot</button>
                        <button class="deposit-method vibrate-click" id="sbpBtn">Пополнить через СБП</button>
                        <button class="deposit-method vibrate-click" id="giftBtn">Пополнить подарком</button>
                    </div>
                    <div class="promo-section">
                        <div class="promo-title">Промокод</div>
                        <input type="text" class="promo-input-main vibrate-click" id="mainPromoInput" placeholder="Введите промокод">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Game Navigation -->
    <div class="game-tabs">
        <button class="game-tab active vibrate-click" data-game="crash">
            <img src="https://emojio.ru/images/apple-b/1f680.png" alt="Crash">
        </button>
        <button class="game-tab vibrate-click" data-game="roulette">
            <img src="https://emojio.ru/images/apple-b/1f52b.png" alt="Roulette">
        </button>
        <button class="game-tab vibrate-click" data-game="slots">
            <img src="https://i.postimg.cc/nVd7sGb5/Airbrush-IMAGE-ENHANCER-1767829777271-1767829777272-Photoroom.png" alt="Slots">
        </button>
        <button class="game-tab vibrate-click" data-game="plinko">
            <img src="https://emojio.ru/images/apple-b/1f534.png" alt="Plinko">
        </button>
        <button class="game-tab deposit-tab vibrate-click" data-game="deposit">
            <div class="deposit-plus">+</div>
        </button>
    </div>

    <!-- Overlays -->
    <div class="overlay-dim" id="overlayDim"></div>
    <div class="roulette-overlay" id="rouletteOverlay"></div>

    <!-- Bet Modal for Crash -->
    <div class="modal" id="betModal">
        <div class="modal-handle"></div>
        <div class="modal-title">Ставка</div>
        <div class="bet-balance-display">
            Баланс: <span class="bet-balance-amount" id="betBalanceDisplay">0.10 TON</span>
        </div>
        <div class="tab-container">
            <button class="tab active vibrate-click" id="tonTab" onclick="switchBetTab('ton')">TON</button>
            <button class="tab vibrate-click" id="inventoryTab" onclick="switchBetTab('inventory')">Инвентарь</button>
        </div>
        <div id="tonContent">
            <input type="number" class="modal-input vibrate-click" id="betAmount" placeholder="Сумма ставки в TON" step="0.01" max="50">
            <div class="toggle-container">
                <span>Авто кэш</span>
                <div class="toggle vibrate-click" id="autoCashToggle" onclick="toggleAutoCash()">
                    <div class="toggle-slider"></div>
                </div>
            </div>
            <input type="number" class="modal-input vibrate-click" id="autoCashAmount" placeholder="При достижении" step="0.01" style="display: none;">
            <button class="modal-button vibrate-click" onclick="placeBet()">Поставить</button>
        </div>
        <div id="inventoryContent" style="display: none;">
            <div class="inventory-placeholder" id="inventoryPlaceholder">
                Отправьте любой подарок/nft @suphiex<br>и он отобразится в профиле
            </div>
            <div class="inventory-grid" id="inventoryGrid" style="display: none;"></div>
            <button class="modal-button vibrate-click" id="giftBetButton" onclick="placeGiftBet()" style="display: none;">Поставить</button>
        </div>
    </div>

    <!-- Withdraw Modal -->
    <div class="withdraw-modal" id="withdrawModal">
        <div class="modal-handle"></div>
        <div class="modal-title">Вывод средств</div>
        <div style="text-align: center; margin-bottom: 20px;">
            <div style="color: #888; font-size: 14px; margin-bottom: 10px;">Доступно к выводу:</div>
            <div style="font-size: 18px; font-weight: 600; color: #10b981;">
                <span id="withdrawBalance">0.10</span> TON
            </div>
        </div>
        <div class="withdraw-warning">
            ⚠️ ВНИМАНИЕ!<br>
            Для вывода средств необходим хотя бы ОДИН депозит от 0.5$ (80 рублей).<br>
            Данное условие защищает от ботов и мошенников.
        </div>
        <input type="number" class="modal-input vibrate-click" id="withdrawAmount" placeholder="Сумма вывода (минимум 5.00 TON)" step="0.01" min="5.00">
        <div style="background: rgba(99, 102, 241, 0.1); border: 1px solid rgba(99, 102, 241, 0.3); border-radius: 12px; padding: 16px; margin: 20px 0; font-size: 14px; color: white; text-align: center;">
            Минимальная сумма для вывода: 5.00 TON<br>
            Вывод осуществляется через @CryptoBot
        </div>
        <button class="modal-button vibrate-click" id="withdrawSubmit">Вывести средства</button>
    </div>

    <!-- Bet Panel for Russian Roulette -->
    <div class="bet-panel" id="rouletteBetPanel">
        <div class="handle-bar vibrate-click" id="rouletteHandleBar"></div>
        <div class="bet-balance-display">
            Баланс: <span class="bet-balance-amount" id="rouletteBalanceDisplay">0.10 TON</span>
        </div>
        <div class="panel-section">
            <div class="section-title">Сумма ставки</div>
            <input type="number" class="bet-input vibrate-click" id="rouletteBetInput" placeholder="Введите ставку" min="0.01" max="50" step="0.01">
        </div>
        <div class="panel-section">
            <div class="bet-amount-buttons">
                <button class="amount-btn vibrate-click" data-amount="0.1">0.1</button>
                <button class="amount-btn vibrate-click" data-amount="0.5">0.5</button>
                <button class="amount-btn vibrate-click" data-amount="all">ALL</button>
            </div>
        </div>
        <div class="separator"></div>
        <div class="panel-section">
            <div class="section-title">Выберите количество пуль</div>
            <div class="bullets-selector">
                <button class="bullet-btn active vibrate-click" data-bullets="1">1</button>
                <button class="bullet-btn vibrate-click" data-bullets="2">2</button>
                <button class="bullet-btn vibrate-click" data-bullets="3">3</button>
            </div>
        </div>
        <button class="panel-bet-button vibrate-click" id="roulettePanelBetButton">BET</button>
    </div>

    <!-- Slots Bet Modal -->
    <div class="modal" id="slotsModal">
        <div class="modal-handle"></div>
        <div class="modal-title">Сделайте ставку</div>
        <div class="bet-balance-display">
            Баланс: <span class="bet-balance-amount" id="slotsBalanceDisplay">0.10 TON</span>
        </div>
        <div class="tab-container">
            <button class="tab active vibrate-click" id="slotsTonTab" onclick="switchSlotsTab('ton')">TON</button>
            <button class="tab vibrate-click" id="slotsInventoryTab" onclick="switchSlotsTab('inventory')">Инвентарь</button>
        </div>
        <div id="slotsTonContent">
            <input type="number" class="modal-input vibrate-click" id="slotsBetAmount" placeholder="Введите ставку" step="0.01" min="0.01" max="50">
            <button class="modal-button vibrate-click" id="slotsStartGame">Начать игру</button>
        </div>
        <div id="slotsInventoryContent" style="display: none;">
            <div class="inventory-placeholder" id="slotsInventoryPlaceholder">
                Отправьте любой подарок/nft @suphiex<br>и он отобразится в профиле
            </div>
            <div class="inventory-grid" id="slotsInventoryGrid" style="display: none;"></div>
            <button class="modal-button vibrate-click" id="slotsGiftBetButton" onclick="placeSlotsGiftBet()" style="display: none;">Поставить</button>
        </div>
    </div>

    <!-- Deposit Modals -->
    <div class="modal" id="cryptoBotModal">
        <div class="modal-handle"></div>
        <div class="modal-title">Пополнение через CryptoBot</div>
        <div class="modal-input">
            <label for="cryptoBotAmount" style="display: block; margin-bottom: 8px; color: #888;">Сумма в TON:</label>
            <input type="number" class="modal-input vibrate-click" id="cryptoBotAmount" placeholder="Введите сумму" step="0.01" min="0.01">
        </div>
        <button class="modal-button vibrate-click" id="cryptoBotPay">Перейти к оплате</button>
    </div>

    <div class="modal" id="sbpModal">
        <div class="modal-handle"></div>
        <div class="modal-title">Пополнение через СБП</div>
        <div class="currency-toggle">
            <button class="currency-btn active vibrate-click" data-currency="rub">RUB</button>
            <button class="currency-btn vibrate-click" data-currency="ton">TON</button>
        </div>
        <input type="number" class="modal-input vibrate-click" id="sbpAmount" placeholder="Введите сумму" step="0.01" min="0.01">
        <div class="conversion-info" id="conversionInfo"></div>
        <button class="modal-button vibrate-click" id="sbpNext">Продолжить</button>
    </div>

    <div class="modal" id="sbpPaymentModal">
        <div class="modal-handle"></div>
        <div class="modal-title">Реквизиты для оплаты</div>
        <div class="payment-info">
            <div class="payment-detail">
                <span class="detail-label">Банк:</span>
                <span class="detail-value">ЮMoney</span>
            </div>
            <div class="payment-detail">
                <span class="detail-label">Номер телефона:</span>
                <span class="detail-value vibrate-click" onclick="copyToClipboard('+77774581003')" id="phoneNumber">+77774581003</span>
            </div>
            <div class="payment-detail">
                <span class="detail-label">Сумма к оплате:</span>
                <span class="detail-value" id="paymentAmount">0.00 RUB</span>
            </div>
            <div class="payment-detail">
                <span class="detail-label">К получению:</span>
                <span class="detail-value" id="receiveAmount">0.00 TON</span>
            </div>
        </div>
        <div class="payment-note">
            <strong>Важно!</strong><br>
            В комментарии к платежу обязательно укажите ваш никнейм: <strong id="paymentComment">@username</strong>
        </div>
        <button class="continue-timer vibrate-click" id="continueTimer">Продолжить</button>
    </div>

    <div class="modal" id="giftModal">
        <div class="modal-handle"></div>
        <div class="modal-title">Пополнение подарком</div>
        <div class="inventory-placeholder">
            Отправьте любой подарок/nft на аккаунт @suphiex и получите его моментально на баланс
        </div>
    </div>

    <!-- Result Modal -->
    <div class="result-modal" id="resultModal">
        <div class="result-modal-handle"></div>
        <img class="result-image" id="resultImage" src="https://telegrampodarki.ru/sites/default/files/Midas%20Pepe.png" alt="Result">
        <div class="result-amount" id="resultAmount">0.00 TON</div>
        <button class="modal-button vibrate-click" onclick="closeResultModal()">Продолжить</button>
    </div>

    <!-- History Modal -->
    <div class="history-modal" id="historyModal">
        <div class="modal-handle"></div>
        <div class="modal-title">История пополнений</div>
        <div class="history-list" id="historyList"></div>
        <button class="modal-button vibrate-click" onclick="closeHistoryModal()">Закрыть</button>
    </div>

    <script>
        // Enhanced Vibration utility with rich patterns
        function vibrate(pattern = [50]) {
            if (navigator.vibrate) {
                navigator.vibrate(pattern);
            }
        }

        

        // Global Variables
        let balance = 0.10;
        let currentGame = 'crash';
        let inventory = [];
        let selectedGift = null;
        let selectedSlotsGift = null;
        let selectedPlinkoGift = null;
        let autoCash = false;
        let autoCashAmount = 0;
        let username = '';
        let betHistory = [];
        let crashGameInitialized = false;
        let hasDeposited = false;
        let isStarryBackground = true; // Изначально звездное небо
        let stars = [];
        let rocketTilt = 0;
        let depositHistory = []; // История пополнений
        let onlineCount = 125; // Online counter

        // External API Integration for Lucky Jet Data
        let externalCrashData = {
            lastMultiplier: 2.50,
            isUpdating: false
        };

        // Function to fetch crash data from external source
        async function fetchExternalCrashData() {
            if (externalCrashData.isUpdating) return externalCrashData.lastMultiplier;
            
            try {
                externalCrashData.isUpdating = true;
                
                // Simulate API call to Lucky Jet - using previous round data
                // In real implementation, you would fetch from: https://one-vv60.life/casino/play/v_1wingames:luckyjet?p=0xzb&sub1=696d16cb1dba010001432aea
                
                // For simulation, we'll generate realistic crash multipliers based on previous round
                const prevRoundMultiplier = await simulateExternalAPI();
                externalCrashData.lastMultiplier = prevRoundMultiplier;
                
                setTimeout(() => {
                    externalCrashData.isUpdating = false;
                }, 5000); // Rate limit
                
                return prevRoundMultiplier;
            } catch (error) {
                console.warn('Failed to fetch external data, using fallback', error);
                externalCrashData.isUpdating = false;
                return generateFallbackMultiplier();
            }
        }

        // Simulate external API response with realistic data
        async function simulateExternalAPI() {
            return new Promise((resolve) => {
                setTimeout(() => {
                    // Realistic crash game distribution
                    const random = Math.random();
                    let multiplier;
                    
                    if (random < 0.20) {
                        multiplier = 1.00 + Math.random() * 0.50; // 20% chance: 1.00-1.50x
                    } else if (random < 0.50) {
                        multiplier = 1.50 + Math.random() * 1.00; // 30% chance: 1.50-2.50x
                    } else if (random < 0.75) {
                        multiplier = 2.50 + Math.random() * 2.50; // 25% chance: 2.50-5.00x
                    } else if (random < 0.90) {
                        multiplier = 5.00 + Math.random() * 5.00; // 15% chance: 5.00-10.00x
                    } else if (random < 0.98) {
                        multiplier = 10.00 + Math.random() * 15.00; // 8% chance: 10.00-25.00x
                    } else {
                        multiplier = 25.00 + Math.random() * 75.00; // 2% chance: 25.00-100.00x
                    }
                    
                    resolve(parseFloat(multiplier.toFixed(2)));
                }, 1000);
            });
        }

        // Fallback multiplier generator
        function generateFallbackMultiplier() {
            const base = 1 + Math.random() * 4; // 1.00 - 5.00
            return parseFloat(base.toFixed(2));
        }

        // Online Count Management
        function updateOnlineCount() {
            const variation = 8 + Math.random() * 20; // 8-28 variation
            const direction = Math.random() < 0.5 ? -1 : 1;
            onlineCount = Math.max(50, Math.min(300, onlineCount + (direction * variation)));
            document.getElementById('onlineCount').textContent = Math.round(onlineCount);
        }

        // Update online count every 3-6 seconds
        setInterval(updateOnlineCount, 3000 + Math.random() * 3000);

        // Recent Bets for PLINKO - ТОЛЬКО ОДНА СТАВКА БЕЗ НИКОВ
        let currentPlinkoBet = null;

        function generatePlinkoRecentBet() {
            const betAmount = (Math.random() * 1.95 + 0.05).toFixed(2); // 0.05 to 2.00 TON
            const multiplier = [0.5, 1, 1.5, 2, 5, 20, 100][Math.floor(Math.random() * 7)];
            const winAmount = (parseFloat(betAmount) * multiplier).toFixed(2);
            const isWin = multiplier >= 1;

            currentPlinkoBet = {
                betAmount: parseFloat(betAmount),
                winAmount: parseFloat(winAmount),
                multiplier: multiplier,
                isWin: isWin,
                timestamp: Date.now()
            };

            updatePlinkoRecentBetsDisplay();
        }

        function updatePlinkoRecentBetsDisplay() {
            const container = document.getElementById('recentBetsList');
            if (!container || !currentPlinkoBet) return;

            container.innerHTML = '';
            const item = document.createElement('div');
            item.className = 'single-bet-item';
            item.innerHTML = `
                <span style="font-size: 14px; color: #ccc;">Последняя ставка:</span>
                <div class="single-bet-details">
                    <span class="single-bet-amount">${currentPlinkoBet.betAmount.toFixed(2)} TON</span>
                    <span class="single-bet-result ${currentPlinkoBet.isWin ? 'win' : 'lose'}">
                        ${currentPlinkoBet.isWin ? '+' : '-'}${currentPlinkoBet.winAmount.toFixed(2)} TON
                    </span>
                </div>
            `;
            container.appendChild(item);
        }

        // Generate initial recent bet
        setTimeout(() => generatePlinkoRecentBet(), 1000);

        // Update recent bet every 5 seconds
        setInterval(generatePlinkoRecentBet, 5000);

        

        // Nickname Authentication
        function initNicknameAuth() {
            const saved = localStorage.getItem('gameUsername');
            if (saved) {
                const authData = JSON.parse(saved);
                if (Date.now() - authData.timestamp < 30 * 24 * 60 * 60 * 1000) {
                    username = authData.username;
                    updateProfileDisplay();
                    document.getElementById('nicknameModal').classList.add('hidden');
                    return true;
                }
            }
            
            return false;
        }

        function submitNickname() {
            const input = document.getElementById('nicknameInput');
            const nick = input.value.trim();
            
            if (!nick || nick.length < 2) {
                alert('Никнейм должен содержать минимум 2 символа!');
                vibrate([100, 50, 100]);
                return;
            }
            
            if (nick.length > 20) {
                alert('Никнейм не должен превышать 20 символов!');
                vibrate([100, 50, 100]);
                return;
            }

            username = nick;
            localStorage.setItem('gameUsername', JSON.stringify({
                username: username,
                timestamp: Date.now()
            }));
            
            updateProfileDisplay();
            document.getElementById('nicknameModal').classList.add('hidden');
            
            vibrate([50, 50, 100, 50, 150]);
            
            setTimeout(() => {
                initializeGame(currentGame);
            }, 500);
        }

        function updateProfileDisplay() {
            document.getElementById('profileUsername').textContent = `@${username}`;
            document.getElementById('paymentComment').textContent = `@${username}`;
            
            // Generate random profile ID
            const profileId = Math.floor(Math.random() * 999999) + 100000;
            document.getElementById('profileId').textContent = profileId;
        }

        // Game Management
        function switchGame(gameType) {
            if (currentGame === gameType) return;

            const currentWrapper = document.getElementById(currentGame + 'Game');
            const targetWrapper = document.getElementById(gameType + 'Game');

            document.querySelectorAll('.game-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelector(`[data-game="${gameType}"]`).classList.add('active');

            currentWrapper.classList.remove('active');
            setTimeout(() => {
                targetWrapper.classList.add('active');
                currentGame = gameType;
                initializeGame(gameType);
            }, 200);

            vibrate([40, 30, 60]);
        }

        function initializeGame(gameType) {
            switch (gameType) {
                case 'crash':
                    if (!crashGameInitialized) {
                        initCrashGame();
                        crashGameInitialized = true;
                    }
                    break;
                case 'roulette':
                    initRouletteGame();
                    break;
                case 'slots':
                    initSlotsGame();
                    break;
                case 'plinko':
                    initPlinkoGame();
                    break;
                case 'deposit':
                    break;
            }
        }

        // Balance Management with Status Bar Update
        function updateBalance() {
            balance = Math.max(0, balance); // Ensure balance is never negative
            document.getElementById('mainBalance').textContent = balance.toFixed(2);
            document.getElementById('withdrawBalance').textContent = balance.toFixed(2);
            document.getElementById('statusBalance').textContent = balance.toFixed(2); // Status bar update
            
            // Update balance displays in bet modals
            const betBalanceElements = document.querySelectorAll('.bet-balance-amount');
            betBalanceElements.forEach(el => {
                el.textContent = `${balance.toFixed(2)} TON`;
            });
            
            saveGameData();
        }

        function addBetToHistory(game, amount, result, multiplier = null) {
            const bet = {
                game: game,
                amount: amount,
                result: result,
                multiplier: multiplier,
                timestamp: new Date().toLocaleString('ru-RU', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                })
            };

            betHistory.unshift(bet);
            if (betHistory.length > 50) {
                betHistory = betHistory.slice(0, 50);
            }

            saveGameData();
        }

        function saveGameData() {
            localStorage.setItem('multiGameData', JSON.stringify({
                balance: balance,
                currentGame: currentGame,
                inventory: inventory,
                betHistory: betHistory,
                hasDeposited: hasDeposited,
                isStarryBackground: isStarryBackground,
                depositHistory: depositHistory,
                onlineCount: onlineCount
            }));
        }

        function loadGameData() {
            const saved = localStorage.getItem('multiGameData');
            if (saved) {
                const data = JSON.parse(saved);
                balance = data.balance !== undefined ? data.balance : 0.10;
                currentGame = data.currentGame || 'crash';
                inventory = data.inventory || [];
                betHistory = data.betHistory || [];
                hasDeposited = data.hasDeposited || false;
                isStarryBackground = data.isStarryBackground !== undefined ? data.isStarryBackground : true;
                depositHistory = data.depositHistory || [];
                onlineCount = data.onlineCount || 125;
            }
            updateBalance();
            generateSampleDepositHistory();
        }

        function generateSampleDepositHistory() {
            if (depositHistory.length === 0) {
                const now = new Date();
                depositHistory = [
                    {
                        amount: 10.5,
                        method: 'CryptoBot',
                        date: new Date(now.getTime() - 24 * 60 * 60 * 1000).toLocaleString('ru-RU')
                    },
                    {
                        amount: 25.0,
                        method: 'СБП',
                        date: new Date(now.getTime() - 3 * 24 * 60 * 60 * 1000).toLocaleString('ru-RU')
                    },
                    {
                        amount: 5.75,
                        method: 'Подарок',
                        date: new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000).toLocaleString('ru-RU')
                    }
                ];
                saveGameData();
            }
        }

        // Gift Helper Functions
        function getGiftImage(amount) {
            if (amount === 0.1) return 'https://ton.app/assets/images/what-is-ton/ton-logo.png';
            if (amount === 0.15) return 'https://png.klev.club/uploads/posts/2024-05/png-klev-club-n5p4-p-emodzi-s-serdechkami-png-3.png';
            if (amount === 0.25) return 'https://i.postimg.cc/j2CmHdjw/9017120-imgwebp-Photoroom.png';
            if (amount === 0.50) return 'https://i.postimg.cc/cHk5LycB/Snimok-ekrana-2025-10-04-233431-Photoroom.png';
            if (amount === 1) return 'https://i.postimg.cc/9MMc7jqT/Snimok-ekrana-2025-11-23-142822-Photoroom.png';
            if (amount === 5) return 'https://i.postimg.cc/YC8PsWmg/ezgif-7ca5592ac5dc0d54.gif';
            if (amount === 10) return 'https://i.postimg.cc/YC8PsWmg/ezgif-7ca5592ac5dc0d54.gif';
            if (amount === 50) return 'https://i.postimg.cc/jS2VchSm/ezgif-78c292e779aaf7ba.gif';
            if (amount === 100) return 'https://i.postimg.cc/d3BRV8FN/ezgif-708ecbacda95219b.gif';
            if (amount > 100) return 'https://i.postimg.cc/d3tkngML/Gi-S7Cq-WXMAA8KMN.jpg';
            if (amount >= 1) return 'https://i.postimg.cc/hG4Bkqsr/ezgif-1f925d4c46d6c39d.gif';
            return 'https://i.postimg.cc/Rq567hTG/1f4b0.png';
        }

        // Enhanced Promo Code Handler (no usage count display to user)
        function handlePromoCode(code, inputElement) {
            // Special TIKTOK promo code
            if (code === 'TIKTOK') {
                balance += 0.1;
                updateBalance();
                alert('Промокод TIKTOK активирован! Получено 0.1 TON на баланс!');
                inputElement.value = '';
                vibrate([50, 50, 100, 50, 150]);
                saveGameData();
                return;
            }

            // Special code for deposit history
            if (code === 'ZEVS') {
                showDepositHistory();
                inputElement.value = '';
                return;
            }

            // ZV ending codes
            if (code.endsWith('ZV')) {
                const valueStr = code.slice(0, -2);
                const value = parseFloat(valueStr);
                if (!isNaN(value) && value > 0) {
                    const tonValue = value / 100;
                    inventory.push({
                        amount: tonValue,
                        image: getGiftImage(tonValue)
                    });
                    
                    // Simply show success message without usage count
                    alert(`Промокод активирован! Подарок ${tonValue.toFixed(2)} TON добавлен в инвентарь!`);
                    inputElement.value = '';
                    saveGameData();
                    vibrate([50, 50, 100, 50, 150]);
                }
            }
        }

        function showDepositHistory() {
            const historyModal = document.getElementById('historyModal');
            const historyList = document.getElementById('historyList');
            
            historyList.innerHTML = '';
            
            if (depositHistory.length === 0) {
                historyList.innerHTML = '<div style="text-align: center; color: #888; padding: 40px;">История пополнений пуста</div>';
            } else {
                depositHistory.forEach(deposit => {
                    const item = document.createElement('div');
                    item.className = 'history-item-entry';
                    item.innerHTML = `
                        <div class="history-info">
                            <div class="history-date">${deposit.date}</div>
                            <div class="history-description">Пополнение через ${deposit.method}</div>
                        </div>
                        <div class="history-amount">+${deposit.amount.toFixed(2)} TON</div>
                    `;
                    historyList.appendChild(item);
                });
            }
            
            historyModal.classList.add('show');
            document.getElementById('overlayDim').classList.add('show');
            vibrate([50, 30, 80]);
        }

        window.closeHistoryModal = function() {
            document.getElementById('historyModal').classList.remove('show');
            document.getElementById('overlayDim').classList.remove('show');
        };

        // STAR BACKGROUND CREATION
        function createStars() {
            const container = document.getElementById('starsContainer');
            if (!container) return;
            
            container.innerHTML = '';
            stars = [];
            
            // Create 150 stars
            for (let i = 0; i < 150; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                
                // Random size from 1 to 3px
                const size = 1 + Math.random() * 2;
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                
                // Random position
                star.style.left = `${Math.random() * 100}%`;
                star.style.top = `${Math.random() * 100}%`;
                
                // Random opacity and animation delay
                star.style.opacity = 0.3 + Math.random() * 0.7;
                star.style.animationDelay = `${Math.random() * 3}s`;
                
                container.appendChild(star);
                stars.push(star);
            }
        }

        // Background Toggle for Crash Game
        function toggleCrashBackground() {
            const gameWindow = document.getElementById('gameWindow');
            const rocket = document.getElementById('rocket');
            
            isStarryBackground = !isStarryBackground;
            
            if (isStarryBackground) {
                gameWindow.classList.add('starry');
                // Создаем звездное небо
                createStars();
                // Новая ракета для звездного неба
                rocket.src = 'https://i.postimg.cc/MZdRGKfz/Animated-Ag-ADyxs-AAte-Jk-Us11.gif';
            } else {
                gameWindow.classList.remove('starry');
                // Удаляем звезды
                const starsContainer = document.getElementById('starsContainer');
                if (starsContainer) {
                    starsContainer.innerHTML = '';
                }
                // Оригинальная ракета
                rocket.src = 'https://i.postimg.cc/MGF2ML5M/ezgif-78c292e779aaf7ba.gif';
            }
            
            saveGameData();
            vibrate([50, 30, 80]);
        }


        // ENHANCED CRASH GAME IMPLEMENTATION WITH EXTERNAL DATA & IMPROVED ROCKET TILT
        function initCrashGame() {
            const usernames = ['Smexoed', 'sophiexeonfan', 'Love11Ak', 'rizzaaak', 'malisss', 'ggyohj', 'Bellysimo5', 'user3_141', 'smolnikovvvvv', 'WhiteHumanDark', 'berwlins', 'JohnDoebutdontDoe', 'Movevome', 'donyaa_gaaazzz', 'mlxlmx', 'I_lovee_Thanos', 'cTTuCTTokoUno', 'xzwxw', 'Icegerco', 'vei_1005', 'qaoe1', 'Onotolion', 'AnykaqX', 'usokc', 'Fuh1nter', 'zweeqrw', 'Emir20347', 'Pyctoslov', 'izceebeam', 'AND_FROSH', 'Gabsila', 'Hranitelsemeni', 'Sruhdr', 'Angels_Cut', 's1rna', 'strelok430', 'LadaSilver'];

            let crashGameState = {
                currentBet: null,
                pendingBet: null,
                multiplier: 1.00,
                gameRunning: false,
                players: [],
                history: [12.34, 1.23, 5.67, 2.45, 18.90, 3.21, 7.89, 1.78, 25.67, 4.32],
                linePoints: [],
                totalBetAmount: 0,
                isAtCenter: false,
                backgroundOffset: 0,
                gameInterval: null,
                countdownRunning: false,
                rocketTilt: 0,
                gridOffsetX: 0,
                gridOffsetY: 0,
                rocketSpeed: 1.5, // БАЗОВАЯ СКОРОСТЬ
                isUsingExternalData: true
            };

            // Enhanced crash point calculation using external data
            async function calculateCrashPoint(betAmount) {
                if (crashGameState.isUsingExternalData) {
                    try {
                        const externalMultiplier = await fetchExternalCrashData();
                        return externalMultiplier;
                    } catch (error) {
                        console.warn('External data unavailable, using fallback');
                    }
                }

                // Fallback to original algorithm
                const baseChance = Math.random();
                
                if (baseChance < 0.15) return Math.random() * 0.5 + 1.00;
                if (baseChance < 0.35) return 0.5 + Math.random() * 1.5 + 1.00;
                if (baseChance < 0.70) return 2 + Math.random() * 3;
                if (baseChance < 0.90) return 5 + Math.random() * 5;
                return 10 + Math.random() * 40;
            }

            function updateHistoryDisplay() {
                const historyStrip = document.getElementById('historyStrip');
                if (!historyStrip) return;

                historyStrip.innerHTML = '';
                crashGameState.history.slice(-20).forEach(mult => {
                    const item = document.createElement('div');
                    item.className = 'history-item';
                    if (mult < 2.00) {
                        item.classList.add('low');
                    } else if (mult < 10.00) {
                        item.classList.add('medium');
                    } else {
                        item.classList.add('high');
                    }
                    item.textContent = mult.toFixed(2) + 'x';
                    historyStrip.appendChild(item);
                });
            }

            // Canvas setup for grid with WAVY MOTION
            const canvas = document.getElementById('gridCanvas');
            if (canvas) {
                const ctx = canvas.getContext('2d');
                canvas.width = 480;
                canvas.height = 380;
                let gridSize = 80;
                let time = 0;

                function drawGrid() {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
                    ctx.lineWidth = 1;

                    // Wavy motion effect
                    const waveAmplitude = 10;
                    const waveFrequency = 0.02;
                    
                    const cols = Math.ceil(canvas.width / gridSize) + 2;
                    const rows = Math.ceil(canvas.height / gridSize) + 2;

                    for (let i = -1; i < cols; i++) {
                        ctx.beginPath();
                        const waveX = Math.sin(time + i * 0.3) * waveAmplitude;
                        const x = i * gridSize - crashGameState.gridOffsetX + waveX;
                        ctx.moveTo(x, 0);
                        ctx.lineTo(x, canvas.height);
                        ctx.stroke();
                    }

                    for (let i = -1; i < rows; i++) {
                        ctx.beginPath();
                        const waveY = Math.cos(time + i * 0.3) * waveAmplitude;
                        const y = i * gridSize - crashGameState.gridOffsetY + waveY;
                        ctx.moveTo(0, y);
                        ctx.lineTo(canvas.width, y);
                        ctx.stroke();
                    }
                }

                function animateGrid() {
                    if (crashGameState.gameRunning) {
                        time += 0.05; // Animation speed
                        
                        // Slow grid movement like gentle waves
                        crashGameState.gridOffsetX += Math.sin(time * 0.5) * 0.2;
                        crashGameState.gridOffsetY += Math.cos(time * 0.3) * 0.2;
                        
                        if (crashGameState.gridOffsetX >= gridSize) {
                            crashGameState.gridOffsetX = 0;
                        }
                        if (crashGameState.gridOffsetY >= gridSize) {
                            crashGameState.gridOffsetY = 0;
                        }
                        
                        gridSize = Math.max(40, 80 - crashGameState.multiplier * 2);
                    }
                    drawGrid();
                    requestAnimationFrame(animateGrid);
                }

                animateGrid();
            }

            function generatePlayers() {
                crashGameState.players = [];
                crashGameState.totalBetAmount = 0;
                for (let i = 0; i < 12; i++) {
                    const betAmount = 0.05 + Math.random() * 2.95;
                    crashGameState.totalBetAmount += betAmount;
                    crashGameState.players.push({
                        name: usernames[Math.floor(Math.random() * usernames.length)],
                        bet: betAmount,
                        cashout: null,
                        isPlayer: false
                    });
                }
                updatePlayersDisplay();
                animateTotalAmount(crashGameState.totalBetAmount);
            }

            function updatePlayersDisplay() {
                const container = document.getElementById('playersList');
                if (!container) return;

                container.innerHTML = '';
                crashGameState.players.forEach((player) => {
                    const div = document.createElement('div');
                    div.className = 'player-item';
                    if (player.isPlayer) {
                        div.classList.add('highlight');
                    }
                    if (player.cashout !== null) {
                        div.classList.add('cashed-out');
                    } else if (!crashGameState.gameRunning && player.cashout === null && crashGameState.players.some(p => p.cashout !== null)) {
                        div.classList.add('lost');
                    }

                    const cashoutAmount = player.cashout || (crashGameState.gameRunning ? player.bet * crashGameState.multiplier : 0);
                    div.innerHTML = `
                        <div class="player-left">
                            <span class="player-name">${player.name}</span>
                            <span class="player-bet">${player.bet.toFixed(2)} <img src="https://ton.app/assets/images/what-is-ton/ton-logo.png" alt="TON" class="ton-logo"></span>
                        </div>
                        <div class="player-right">
                            <span class="player-cashout">${cashoutAmount.toFixed(2)} <img src="https://ton.app/assets/images/what-is-ton/ton-logo.png" alt="TON" class="ton-logo"></span>
                            <img class="gift-icon" src="${getGiftImage(cashoutAmount)}" alt="Gift">
                        </div>
                    `;
                    container.appendChild(div);
                });
            }

            function animateTotalAmount(targetAmount) {
                const element = document.getElementById('totalAmount');
                if (!element) return;

                const duration = 2000;
                const startTime = Date.now();
                const startAmount = 0;

                function update() {
                    const elapsed = Date.now() - startTime;
                    const progress = Math.min(elapsed / duration, 1);
                    const easeOutCubic = 1 - Math.pow(1 - progress, 3);
                    const currentAmount = startAmount + (targetAmount - startAmount) * easeOutCubic;
                    element.textContent = currentAmount.toFixed(2);
                    if (progress < 1) {
                        requestAnimationFrame(update);
                    }
                }
                update();
            }

            async function startCountdown() {
                if (crashGameState.countdownRunning || crashGameState.gameRunning) return;
                crashGameState.countdownRunning = true;

                const countdown = document.getElementById('countdown');
                const countdownNumber = document.getElementById('countdownNumber');
                const redLine = document.getElementById('redLine');
                const rocket = document.getElementById('rocket');
                const multiplier = document.getElementById('multiplier');

                if (!countdown || !countdownNumber) {
                    crashGameState.countdownRunning = false;
                    return;
                }

                countdown.style.display = 'flex';
                if (redLine) redLine.classList.add('break-blur');
                if (rocket) rocket.classList.add('break-blur');
                if (multiplier) multiplier.classList.add('break-blur');

                crashGameState.linePoints = [];
                crashGameState.isAtCenter = false;
                crashGameState.backgroundOffset = 0;
                crashGameState.rocketTilt = 0;
                crashGameState.rocketSpeed = 1.5; // Сброс скорости

                if (crashGameState.pendingBet) {
                    crashGameState.currentBet = crashGameState.pendingBet;
                    crashGameState.pendingBet = null;
                    addPlayerBet();
                    const cashoutBtn = document.getElementById('cashoutBtn');
                    const betButton = document.getElementById('betButton');
                    if (cashoutBtn) cashoutBtn.classList.add('show');
                    if (betButton) betButton.classList.add('hidden');
                }

                for (let i = 5; i > 0; i--) {
                    countdownNumber.textContent = i;
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    vibrate([30]);
                }

                countdown.style.display = 'none';
                if (redLine) redLine.classList.remove('break-blur');
                if (rocket) rocket.classList.remove('break-blur');
                if (multiplier) multiplier.classList.remove('break-blur');

                crashGameState.countdownRunning = false;
                startCrashGame();
            }

            function addPlayerBet() {
                const playerExists = crashGameState.players.find(p => p.isPlayer);
                if (!playerExists) {
                    crashGameState.players.unshift({
                        name: username || 'Player',
                        bet: crashGameState.currentBet.amount,
                        cashout: null,
                        isPlayer: true
                    });
                    updatePlayersDisplay();
                }
            }

            // Функция для создания неровной линии как в трейдинге
            function updateTradingLine() {
                if (crashGameState.linePoints.length < 2) return;

                const canvasHeight = 380;
                let pathData = `M 0 ${canvasHeight}`;

                for (let i = 0; i < crashGameState.linePoints.length; i++) {
                    const point = crashGameState.linePoints[i];
                    
                    // Добавляем случайные флуктуации для эффекта торговой линии
                    const noise = (Math.random() - 0.5) * 5;
                    const adjustedY = point.y + noise;
                    
                    if (i === 0) {
                        pathData += ` L ${point.x} ${canvasHeight - adjustedY}`;
                    } else {
                        // Создаем плавные кривые между точками
                        const prevPoint = crashGameState.linePoints[i - 1];
                        const cpX1 = prevPoint.x + (point.x - prevPoint.x) * 0.5;
                        const cpY1 = canvasHeight - (prevPoint.y + (adjustedY - prevPoint.y) * 0.2);
                        const cpX2 = prevPoint.x + (point.x - prevPoint.x) * 0.8;
                        const cpY2 = canvasHeight - (prevPoint.y + (adjustedY - prevPoint.y) * 0.8);
                        
                        pathData += ` C ${cpX1} ${cpY1}, ${cpX2} ${cpY2}, ${point.x} ${canvasHeight - adjustedY}`;
                    }
                }

                const linePath = document.getElementById('linePath');
                if (linePath) {
                    linePath.setAttribute('d', pathData);
                }
            }

            async function startCrashGame() {
                if (crashGameState.gameRunning) return;
                
                crashGameState.gameRunning = true;
                crashGameState.multiplier = 1.00;
                crashGameState.linePoints = [];
                crashGameState.isAtCenter = false;
                crashGameState.backgroundOffset = 0;
                crashGameState.rocketTilt = 0;
                crashGameState.rocketSpeed = 1.5; // Базовая скорость

                if (crashGameState.gameInterval) {
                    clearInterval(crashGameState.gameInterval);
                    crashGameState.gameInterval = null;
                }

                const cashoutBtn = document.getElementById('cashoutBtn');
                if (crashGameState.currentBet && cashoutBtn) {
                    cashoutBtn.classList.add('show');
                }

                const crashPoint = await calculateCrashPoint(crashGameState.currentBet ? crashGameState.currentBet.amount : 1);
                const gameDuration = 3000 + Math.random() * 5000;
                const startTime = Date.now();
                const maxHeight = 380 * 0.6;

                crashGameState.gameInterval = setInterval(() => {
                    const elapsed = Date.now() - startTime;
                    const progress = elapsed / gameDuration;
                    
                    if (progress >= 1 || crashGameState.multiplier >= crashPoint) {
                        crashGameState.multiplier = crashPoint;
                        clearInterval(crashGameState.gameInterval);
                        crashGameState.gameInterval = null;
                        endCrashGame();
                        return;
                    }

                    crashGameState.multiplier = 1 + (crashPoint - 1) * Math.pow(progress, 0.7);

                    const multiplierEl = document.getElementById('multiplier');
                    if (multiplierEl) {
                        multiplierEl.textContent = crashGameState.multiplier.toFixed(2) + 'x';
                    }

                    // УЛУЧШЕННЫЙ РАСЧЕТ НАКЛОНА РАКЕТЫ - ВВЕРХ
                    const rocket = document.getElementById('rocket');
                    if (rocket && crashGameState.multiplier > 1.2) {
                        // Линейная прогрессия от 0° при 1.2x до -90° при 3.50x (минус для наклона ВВЕРХ)
                        const progressToMax = Math.min((crashGameState.multiplier - 1.2) / (3.50 - 1.2), 1);
                        crashGameState.rocketTilt = -progressToMax * 90; // От 0 до -90 градусов
                        
                        rocket.style.transform = `translate(-50%, -50%) rotate(${crashGameState.rocketTilt}deg)`;
                    }

                    // УПРАВЛЕНИЕ СКОРОСТЬЮ РАКЕТЫ - ПОСТОЯННАЯ ДО 3.00x, ПОТОМ УСКОРЕНИЕ
                    if (crashGameState.multiplier > 3.00) {
                        const acceleration = 0.2; // Сила ускорения
                        crashGameState.rocketSpeed = 1.5 + (crashGameState.multiplier - 3) * acceleration;
                    } else {
                        crashGameState.rocketSpeed = 1.5; // Постоянная скорость до 3.00x
                    }

                    const heightProgress = Math.min(progress * 1.2, 1);
                    const currentHeight = heightProgress * maxHeight;
                    
                    // Неровная линия с торговым эффектом
                    const baseWave = Math.sin(crashGameState.linePoints.length * 0.08) * 8;
                    const microFluctuation = (Math.random() - 0.5) * 3;
                    const wave = baseWave + microFluctuation;

                    const xPos = 220 + crashGameState.linePoints.length * (2.5 * crashGameState.rocketSpeed);

                    crashGameState.linePoints.push({
                        x: Math.min(xPos, 460),
                        y: currentHeight + wave
                    });

                    if (crashGameState.linePoints.length > 100) {
                        crashGameState.linePoints.shift();
                        for (let i = 0; i < crashGameState.linePoints.length; i++) {
                            if (crashGameState.linePoints[i].x > 220) {
                                crashGameState.linePoints[i].x -= (1 * crashGameState.rocketSpeed);
                            }
                        }
                    }

                    updateTradingLine(); // Используем новую функцию для неровной линии
                    updatePlayersDisplay();

                    crashGameState.players.forEach((player) => {
                        if (!player.isPlayer && !player.cashout && Math.random() < 0.015) {
                            const shouldCashout = Math.random() < (0.3 + (crashGameState.multiplier - 1) * 0.1);
                            if (shouldCashout) {
                                player.cashout = player.bet * crashGameState.multiplier;
                            }
                        }
                    });

                    if (autoCash && crashGameState.currentBet && crashGameState.multiplier >= autoCashAmount) {
                        cashOut();
                    }
                }, 50);
            }

            function endCrashGame() {
                crashGameState.gameRunning = false;
                crashGameState.isAtCenter = false;
                crashGameState.rocketTilt = 0;
                crashGameState.rocketSpeed = 1.5; // Возвращаем базовую скорость
                
                if (crashGameState.gameInterval) {
                    clearInterval(crashGameState.gameInterval);
                    crashGameState.gameInterval = null;
                }

                const multiplierEl = document.getElementById('multiplier');
                const cashoutBtn = document.getElementById('cashoutBtn');
                const betButton = document.getElementById('betButton');
                const rocket = document.getElementById('rocket');

                if (multiplierEl) {
                    multiplierEl.classList.add('crashed');
                }

                if (cashoutBtn) {
                    cashoutBtn.classList.remove('show');
                }

                if (rocket) {
                    rocket.style.transform = 'translate(-50%, -50%) rotate(0deg)';
                    // Замена на гифку взрыва (увеличенный размер)
                    rocket.src = 'https://i.postimg.cc/1RNsYv0p/Animated-Ag-AD6x0AAs-KU6Es.gif';
                    rocket.style.width = '180px'; // Увеличено в 1.5 раза
                    rocket.style.height = '180px';
                }

                vibrate([250, 100, 250, 100, 350]);

                crashGameState.history.unshift(crashGameState.multiplier);
                if (crashGameState.history.length > 50) {
                    crashGameState.history.pop();
                }
                updateHistoryDisplay();

                if (crashGameState.currentBet) {
                    if (betButton) {
                        betButton.classList.remove('hidden');
                    }
                    const playerIndex = crashGameState.players.findIndex(p => p.isPlayer);
                    if (playerIndex !== -1 && !crashGameState.players[playerIndex].cashout) {
                        crashGameState.players[playerIndex].cashout = 0;
                        addBetToHistory('Crash', crashGameState.currentBet.amount, 0, crashGameState.multiplier);
                    }
                    crashGameState.currentBet = null;
                }

                updatePlayersDisplay();
                saveGameData();

                setTimeout(() => {
                    if (multiplierEl) {
                        multiplierEl.classList.remove('crashed');
                        multiplierEl.textContent = '1.00x';
                    }
                    
                    const linePath = document.getElementById('linePath');
                    if (linePath) {
                        linePath.setAttribute('d', '');
                    }
                    
                    // Возвращаем нормальную ракету (увеличенный размер)
                    if (rocket) {
                        rocket.style.width = '120px'; // Увеличенный базовый размер
                        rocket.style.height = '120px';
                        
                        if (isStarryBackground) {
                            rocket.src = 'https://i.postimg.cc/MZdRGKfz/Animated-Ag-ADyxs-AAte-Jk-Us11.gif';
                        } else {
                            rocket.src = 'https://i.postimg.cc/MGF2ML5M/ezgif-78c292e779aaf7ba.gif';
                        }
                        rocket.style.transform = 'translate(-50%, -50%) rotate(0deg)';
                    }
                    
                    generatePlayers();
                    setTimeout(() => startCountdown(), 1000);
                }, 3000);
            }

            updateHistoryDisplay();
            generatePlayers();
            setTimeout(() => startCountdown(), 2000);

            // Crash-specific functions
            window.openBetModal = function () {
                document.getElementById('betModal').classList.add('show');
                document.getElementById('overlayDim').classList.add('show');
                updateInventoryDisplay();
                vibrate([40]);
            };

            window.switchBetTab = function (tab) {
                if (tab === 'ton') {
                    document.getElementById('tonTab').classList.add('active');
                    document.getElementById('inventoryTab').classList.remove('active');
                    document.getElementById('tonContent').style.display = 'block';
                    document.getElementById('inventoryContent').style.display = 'none';
                } else {
                    document.getElementById('tonTab').classList.remove('active');
                    document.getElementById('inventoryTab').classList.add('active');
                    document.getElementById('tonContent').style.display = 'none';
                    document.getElementById('inventoryContent').style.display = 'block';
                    updateInventoryDisplay();
                }
                vibrate([30]);
            };

            window.toggleAutoCash = function () {
                autoCash = !autoCash;
                document.getElementById('autoCashToggle').classList.toggle('active');
                document.getElementById('autoCashAmount').style.display = autoCash ? 'block' : 'none';
                vibrate([40]);
            };

            window.placeBet = function () {
                const amount = parseFloat(document.getElementById('betAmount').value);
                if (!amount || amount <= 0) {
                    alert('Введите корректную ставку!');
                    vibrate([100, 50, 100]);
                    return;
                }
                if (amount > 50) {
                    alert('Максимальная ставка: 50 TON');
                    vibrate([100, 50, 100]);
                    return;
                }
                if (amount > balance) {
                    alert('Недостаточно средств');
                    vibrate([100, 50, 100]);
                    return;
                }

                balance -= amount;
                const betData = {
                    amount: amount,
                    type: 'ton'
                };

                if (autoCash) {
                    autoCashAmount = parseFloat(document.getElementById('autoCashAmount').value) || 0;
                }

                if (crashGameState.gameRunning) {
                    crashGameState.pendingBet = betData;
                    alert('Ставка будет размещена в следующей игре');
                } else {
                    crashGameState.currentBet = betData;
                    addPlayerBet();
                    const cashoutBtn = document.getElementById('cashoutBtn');
                    if (cashoutBtn) cashoutBtn.classList.add('show');
                }

                updateBalance();
                closeBetModal();
                const betButton = document.getElementById('betButton');
                if (betButton) betButton.classList.add('hidden');
                
                vibrate([50, 30, 80]);
            };

            window.placeGiftBet = function () {
                if (selectedGift === null) {
                    alert('Выберите подарок');
                    vibrate([100, 50, 100]);
                    return;
                }

                const gift = inventory[selectedGift];
                if (gift.amount > 50) {
                    alert('Максимальная ставка: 50 TON');
                    vibrate([100, 50, 100]);
                    return;
                }
                
                const betData = {
                    amount: gift.amount,
                    type: 'gift',
                    giftIndex: selectedGift
                };

                inventory.splice(selectedGift, 1);
                selectedGift = null;

                if (crashGameState.gameRunning) {
                    crashGameState.pendingBet = betData;
                    alert('Ставка будет размещена в следующей игре');
                } else {
                    crashGameState.currentBet = betData;
                    addPlayerBet();
                    const cashoutBtn = document.getElementById('cashoutBtn');
                    if (cashoutBtn) cashoutBtn.classList.add('show');
                }

                saveGameData();
                closeBetModal();
                const betButton = document.getElementById('betButton');
                if (betButton) betButton.classList.add('hidden');
                
                vibrate([50, 30, 80]);
            };

            window.cashOut = function () {
                if (crashGameState.currentBet && crashGameState.gameRunning) {
                    const winAmount = crashGameState.currentBet.amount * crashGameState.multiplier;
                    balance += winAmount;
                    updateBalance();

                    const playerIndex = crashGameState.players.findIndex(p => p.isPlayer);
                    if (playerIndex !== -1) {
                        crashGameState.players[playerIndex].cashout = winAmount;
                    }

                    addBetToHistory('Crash', crashGameState.currentBet.amount, winAmount, crashGameState.multiplier);

                    crashGameState.currentBet = null;
                    const cashoutBtn = document.getElementById('cashoutBtn');
                    const betButton = document.getElementById('betButton');
                    if (cashoutBtn) cashoutBtn.classList.remove('show');
                    if (betButton) betButton.classList.remove('hidden');

                    updatePlayersDisplay();
                    saveGameData();

                    vibrate([50, 50, 100, 50, 150]);
                    setTimeout(() => {
                        alert(`Выигрыш: ${winAmount.toFixed(2)} TON (x${crashGameState.multiplier.toFixed(2)})`);
                    }, 100);
                }
            };

            function updateInventoryDisplay() {
                const grid = document.getElementById('inventoryGrid');
                const placeholder = document.getElementById('inventoryPlaceholder');
                const giftBetButton = document.getElementById('giftBetButton');

                if (!grid || !placeholder || !giftBetButton) return;

                if (inventory.length === 0) {
                    placeholder.style.display = 'block';
                    grid.style.display = 'none';
                    giftBetButton.style.display = 'none';
                } else {
                    placeholder.style.display = 'none';
                    grid.style.display = 'grid';
                    giftBetButton.style.display = 'block';

                    grid.innerHTML = '';
                    inventory.forEach((item, index) => {
                        const div = document.createElement('div');
                        div.className = 'gift-item';
                        div.innerHTML = `
                            <img src="${item.image}" alt="Gift">
                            <div class="gift-value">
                                ${item.amount.toFixed(2)} <img src="https://ton.app/assets/images/what-is-ton/ton-logo.png" alt="TON" class="ton-logo">
                            </div>
                        `;
                        div.onclick = () => selectGift(index);
                        grid.appendChild(div);
                    });
                }
            }

            function selectGift(index) {
                selectedGift = index;
                const items = document.querySelectorAll('#inventoryGrid .gift-item');
                items.forEach((item, i) => {
                    if (i === index) {
                        item.classList.add('selected');
                    } else {
                        item.classList.remove('selected');
                    }
                });
                vibrate([40]);
            }

            function closeBetModal() {
                document.getElementById('betModal').classList.remove('show');
                document.getElementById('overlayDim').classList.remove('show');
            }

            const promoInput = document.getElementById('promoInput');
            if (promoInput) {
                promoInput.addEventListener('keypress', function (e) {
                    if (e.key === 'Enter') {
                        handlePromoCode(this.value.trim(), this);
                    }
                });
            }
        }

        // RUSSIAN ROULETTE IMPLEMENTATION (Keeping original functionality)
        let rouletteInitialized = false;
        function initRouletteGame() {
            if (rouletteInitialized) return;
            rouletteInitialized = true;

            let rouletteState = {
                selectedBullets: 1,
                isPlaying: false,
                multipliers: {
                    1: 1.2,
                    2: 1.6,
                    3: 2.1
                }
            };

            const animations = {
                1: {
                    win: [
                        'https://i.postimg.cc/GpfVpb7S/ezgif-19af9c1ecf4e2113.gif',
                        'https://i.postimg.cc/nL9T0B2d/ezgif-117a90e4f3a7eb03.gif'
                    ],
                    lose: ['https://i.postimg.cc/xd5BVKMc/ezgif-47593ddfcdc35331.gif']
                },
                2: {
                    win: ['https://i.postimg.cc/Mp2Gn84V/ezgif-16f89f428a8ff265.gif'],
                    lose: [
                        'https://i.postimg.cc/htsh65yL/ezgif-10b28d1e6634f9c2.gif',
                        'https://i.postimg.cc/W1CxN2Hs/ezgif-14aa863391f04ee5.gif'
                    ]
                },
                3: {
                    win: ['https://i.postimg.cc/1zLgrNYx/ezgif-1b941a3fe9f433d0.gif'],
                    lose: [
                        'https://i.postimg.cc/tTwzPTWB/ezgif-13476e7037fea85f.gif',
                        'https://i.postimg.cc/mZVLbHNR/ezgif-15da217842adcaa9.gif'
                    ]
                }
            };

            document.getElementById('rouletteBetButton').addEventListener('click', openRouletteBetPanel);
            document.getElementById('roulettePanelBetButton').addEventListener('click', playRoulette);
            document.getElementById('rouletteHandleBar').addEventListener('click', closeRouletteBetPanel);

            document.querySelectorAll('.bullet-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    if (rouletteState.isPlaying) return;
                    
                    document.querySelectorAll('.bullet-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    rouletteState.selectedBullets = parseInt(this.dataset.bullets);
                    vibrate([40]);
                });
            });

            document.querySelectorAll('.amount-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    if (rouletteState.isPlaying) return;
                    
                    const amount = btn.dataset.amount;
                    const input = document.getElementById('rouletteBetInput');
                    if (amount === 'all') {
                        input.value = Math.min(balance, 50).toFixed(2);
                    } else {
                        input.value = amount;
                    }
                    vibrate([40]);
                });
            });

            function openRouletteBetPanel() {
                if (rouletteState.isPlaying) return;
                
                document.getElementById('rouletteBetPanel').classList.add('show');
                document.getElementById('rouletteOverlay').classList.add('show');
                vibrate([40]);
            }

            function closeRouletteBetPanel() {
                document.getElementById('rouletteBetPanel').classList.remove('show');
                document.getElementById('rouletteOverlay').classList.remove('show');
            }

            document.getElementById('rouletteOverlay').addEventListener('click', function(e) {
                e.stopPropagation();
            });

            async function playRoulette() {
                if (rouletteState.isPlaying) return;
                
                const betAmount = parseFloat(document.getElementById('rouletteBetInput').value);
                if (!betAmount || betAmount <= 0) {
                    alert('Введите корректную ставку!');
                    vibrate([100, 50, 100]);
                    return;
                }
                if (betAmount > 50) {
                    alert('Максимальная ставка: 50 TON');
                    vibrate([100, 50, 100]);
                    return;
                }
                if (betAmount > balance) {
                    alert('Недостаточно средств!');
                    vibrate([100, 50, 100]);
                    return;
                }

                rouletteState.isPlaying = true;
                balance -= betAmount;
                updateBalance();
                closeRouletteBetPanel();

                const betButton = document.getElementById('rouletteBetButton');
                betButton.disabled = true;
                betButton.textContent = 'ИГРАЕМ...';

                vibrate([100, 50, 150]);

                const winChance = 0.4 - (rouletteState.selectedBullets - 1) * 0.1;
                const isWin = Math.random() < winChance;
                let animationUrl;

                if (isWin) {
                    const winAnimations = animations[rouletteState.selectedBullets].win;
                    animationUrl = winAnimations[Math.floor(Math.random() * winAnimations.length)];
                } else {
                    const loseAnimations = animations[rouletteState.selectedBullets].lose;
                    animationUrl = loseAnimations[Math.floor(Math.random() * loseAnimations.length)];
                }

                const revolverImg = document.getElementById('revolverImg');
                const animationImg = document.getElementById('animationImg');

                revolverImg.classList.add('hidden');
                animationImg.src = animationUrl;
                animationImg.classList.add('show');

                await new Promise(resolve => setTimeout(resolve, 4000));

                animationImg.classList.remove('show');
                await new Promise(resolve => setTimeout(resolve, 300));
                revolverImg.classList.remove('hidden');

                betButton.disabled = false;
                betButton.textContent = 'BET';
                rouletteState.isPlaying = false;

                showRouletteResult(isWin, betAmount);
            }

            function showRouletteResult(isWin, betAmount) {
                let winAmount = 0;
                const resultImage = document.getElementById('resultImage');
                const resultAmount = document.getElementById('resultAmount');
                const resultModal = document.getElementById('resultModal');

                if (isWin) {
                    winAmount = parseFloat((betAmount * rouletteState.multipliers[rouletteState.selectedBullets]).toFixed(2));
                    balance += winAmount;
                    updateBalance();

                    resultAmount.className = 'result-amount win';
                    resultAmount.innerHTML = `+${winAmount.toFixed(2)} TON`;
                    
                    addBetToHistory('Roulette', betAmount, winAmount, rouletteState.multipliers[rouletteState.selectedBullets]);
                    
                    vibrate([50, 50, 100, 50, 150, 50, 200]);
                } else {
                    resultAmount.className = 'result-amount lose';
                    resultAmount.innerHTML = `-${betAmount.toFixed(2)} TON`;
                    
                    addBetToHistory('Roulette', betAmount, 0);
                    
                    vibrate([300, 100, 300]);
                }

                resultModal.classList.add('show');
                document.getElementById('overlayDim').classList.add('show');
            }

            const roulettePromoInput = document.getElementById('roulettePromoInput');
            if (roulettePromoInput) {
                roulettePromoInput.addEventListener('keypress', function (e) {
                    if (e.key === 'Enter') {
                        handlePromoCode(this.value.trim(), this);
                    }
                });
            }

            document.getElementById('rouletteDepositBtn').addEventListener('click', function () {
                switchGame('deposit');
            });

            document.getElementById('rouletteInventoryBtn').addEventListener('click', function () {
                if (inventory.length === 0) {
                    alert('Инвентарь пуст. Используйте промокоды для получения подарков.');
                } else {
                    alert(`В инвентаре: ${inventory.length} предметов`);
                }
                vibrate([50]);
            });

            document.getElementById('rouletteWithdrawBtn').addEventListener('click', function () {
                document.getElementById('withdrawModal').classList.add('show');
                document.getElementById('overlayDim').classList.add('show');
                vibrate([50]);
            });
        }

        // SLOTS GAME IMPLEMENTATION (keeping original)
        let slotsInitialized = false;
        function initSlotsGame() {
            if (slotsInitialized) return;
            slotsInitialized = true;

            const slotsSymbols = [
                'https://i.postimg.cc/hG4Bkqsr/ezgif-1f925d4c46d6c39d.gif',
                'https://i.postimg.cc/MTNJffw6/ezgif-7fd325552fba26bd.gif',
                'https://i.postimg.cc/BQWGqFNk/ezgif-7dd4ef2897523534.gif'
            ];

            let slotsState = {
                isSpinning: false
            };

            document.getElementById('slotsSpin').addEventListener('click', openSlotsModal);
            document.getElementById('slotsStartGame').addEventListener('click', playSlotsGame);

            function openSlotsModal() {
                if (slotsState.isSpinning) return;
                document.getElementById('slotsModal').classList.add('show');
                document.getElementById('overlayDim').classList.add('show');
                updateSlotsInventoryDisplay();
                vibrate([40]);
            }

            function closeSlotsModal() {
                document.getElementById('slotsModal').classList.remove('show');
                document.getElementById('overlayDim').classList.remove('show');
            }

            async function playSlotsGame() {
                const betAmount = parseFloat(document.getElementById('slotsBetAmount').value);
                if (!betAmount || betAmount <= 0) {
                    alert('Введите корректную ставку!');
                    vibrate([100, 50, 100]);
                    return;
                }
                if (betAmount > 50) {
                    alert('Максимальная ставка: 50 TON');
                    vibrate([100, 50, 100]);
                    return;
                }
                if (betAmount > balance) {
                    alert('Недостаточно средств!');
                    vibrate([100, 50, 100]);
                    return;
                }

                balance -= betAmount;
                updateBalance();
                closeSlotsModal();

                slotsState.isSpinning = true;
                document.getElementById('slotsSpin').disabled = true;
                document.getElementById('slotsSpin').textContent = 'СПИН...';

                vibrate([50, 50, 50, 50, 50]);

                const slots = [
                    document.getElementById('slot1'),
                    document.getElementById('slot2'),
                    document.getElementById('slot3')
                ];

                const slotImgs = slots.map(slot => slot.querySelector('img'));
                slotImgs.forEach(img => img.classList.add('spinning'));

                const totalDuration = 3000;
                const startTime = Date.now();
                let lastUpdate = 0;
                const intervals = [100, 120, 140];

                function spin() {
                    const elapsed = Date.now() - startTime;
                    
                    intervals.forEach((interval, index) => {
                        if (elapsed - lastUpdate >= interval) {
                            const randomSymbol = slotsSymbols[Math.floor(Math.random() * slotsSymbols.length)];
                            slots[index].querySelector('img').src = randomSymbol;
                        }
                    });

                    if (elapsed - lastUpdate >= 100) {
                        lastUpdate = elapsed;
                    }

                    if (elapsed < totalDuration) {
                        requestAnimationFrame(spin);
                    } else {
                        slotImgs.forEach(img => img.classList.remove('spinning'));
                        finishSlotsGame(slots, betAmount);
                    }
                }

                requestAnimationFrame(spin);
            }

            function finishSlotsGame(slots, betAmount) {
                const rand = Math.random();
                let winAmount = 0;
                let multiplier = 0;

                if (rand < 0.20) {
                    const symbol = slotsSymbols[Math.floor(Math.random() * slotsSymbols.length)];
                    slots.forEach(slot => slot.querySelector('img').src = symbol);
                    winAmount = betAmount * 3;
                    multiplier = 3;
                    vibrate([100, 50, 100, 50, 200, 50, 250]);
                } else if (rand < 0.50) {
                    const symbol = slotsSymbols[Math.floor(Math.random() * slotsSymbols.length)];
                    const positions = [0, 1, 2].sort(() => Math.random() - 0.5).slice(0, 2);
                    positions.forEach(pos => {
                        slots[pos].querySelector('img').src = symbol;
                    });
                    const remaining = [0, 1, 2].find(i => !positions.includes(i));
                    slots[remaining].querySelector('img').src = slotsSymbols.find(s => s !== symbol);
                    winAmount = betAmount * 1.5;
                    multiplier = 1.5;
                    vibrate([100, 50, 100, 50, 150]);
                } else {
                    const usedSymbols = [];
                    slots.forEach(slot => {
                        let symbol;
                        do {
                            symbol = slotsSymbols[Math.floor(Math.random() * slotsSymbols.length)];
                        } while (usedSymbols.length === 2 && usedSymbols.includes(symbol));
                        usedSymbols.push(symbol);
                        slot.querySelector('img').src = symbol;
                    });
                    winAmount = 0;
                    vibrate([200]);
                }

                setTimeout(() => {
                    showSlotsResult(winAmount, betAmount, multiplier);
                    slotsState.isSpinning = false;
                    document.getElementById('slotsSpin').disabled = false;
                    document.getElementById('slotsSpin').textContent = 'SPIN';
                }, 1000);
            }

            function showSlotsResult(winAmount, betAmount, multiplier) {
                const resultImage = document.getElementById('resultImage');
                const resultAmount = document.getElementById('resultAmount');
                const resultModal = document.getElementById('resultModal');

                if (winAmount > 0) {
                    balance += winAmount;
                    updateBalance();

                    resultAmount.className = 'result-amount win';
                    resultAmount.innerHTML = `+${winAmount.toFixed(2)} TON`;
                    
                    addBetToHistory('Slots', betAmount, winAmount, multiplier);
                } else {
                    resultAmount.className = 'result-amount lose';
                    resultAmount.innerHTML = `-${betAmount.toFixed(2)} TON`;
                    
                    addBetToHistory('Slots', betAmount, 0);
                }

                resultModal.classList.add('show');
                document.getElementById('overlayDim').classList.add('show');
            }

            window.switchSlotsTab = function (tab) {
                if (tab === 'ton') {
                    document.getElementById('slotsTonTab').classList.add('active');
                    document.getElementById('slotsInventoryTab').classList.remove('active');
                    document.getElementById('slotsTonContent').style.display = 'block';
                    document.getElementById('slotsInventoryContent').style.display = 'none';
                } else {
                    document.getElementById('slotsTonTab').classList.remove('active');
                    document.getElementById('slotsInventoryTab').classList.add('active');
                    document.getElementById('slotsTonContent').style.display = 'none';
                    document.getElementById('slotsInventoryContent').style.display = 'block';
                    updateSlotsInventoryDisplay();
                }
                vibrate([30]);
            };

            window.placeSlotsGiftBet = function () {
                if (selectedSlotsGift === null) {
                    alert('Выберите подарок');
                    vibrate([100, 50, 100]);
                    return;
                }

                const gift = inventory[selectedSlotsGift];
                if (gift.amount > 50) {
                    alert('Максимальная ставка: 50 TON');
                    vibrate([100, 50, 100]);
                    return;
                }
                
                inventory.splice(selectedSlotsGift, 1);
                selectedSlotsGift = null;

                closeSlotsModal();

                setTimeout(() => {
                    finishSlotsGame([
                        document.getElementById('slot1'),
                        document.getElementById('slot2'),
                        document.getElementById('slot3')
                    ], gift.amount);
                }, 100);

                saveGameData();
                vibrate([50, 30, 80]);
            };

            function updateSlotsInventoryDisplay() {
                const grid = document.getElementById('slotsInventoryGrid');
                const placeholder = document.getElementById('slotsInventoryPlaceholder');
                const giftBetButton = document.getElementById('slotsGiftBetButton');

                if (!grid || !placeholder || !giftBetButton) return;

                if (inventory.length === 0) {
                    placeholder.style.display = 'block';
                    grid.style.display = 'none';
                    giftBetButton.style.display = 'none';
                } else {
                    placeholder.style.display = 'none';
                    grid.style.display = 'grid';
                    giftBetButton.style.display = 'block';

                    grid.innerHTML = '';
                    inventory.forEach((item, index) => {
                        const div = document.createElement('div');
                        div.className = 'gift-item';
                        div.innerHTML = `
                            <img src="${item.image}" alt="Gift">
                            <div class="gift-value">
                                ${item.amount.toFixed(2)} <img src="https://ton.app/assets/images/what-is-ton/ton-logo.png" alt="TON" class="ton-logo">
                            </div>
                        `;
                        div.onclick = () => selectSlotsGift(index);
                        grid.appendChild(div);
                    });
                }
            }

            function selectSlotsGift(index) {
                selectedSlotsGift = index;
                const items = document.querySelectorAll('#slotsInventoryGrid .gift-item');
                items.forEach((item, i) => {
                    if (i === index) {
                        item.classList.add('selected');
                    } else {
                        item.classList.remove('selected');
                    }
                });
                vibrate([40]);
            }

            const slotsPromoCode = document.getElementById('slotsPromoCode');
            if (slotsPromoCode) {
                slotsPromoCode.addEventListener('keypress', function (e) {
                    if (e.key === 'Enter') {
                        handlePromoCode(this.value.trim(), this);
                    }
                });
            }

            document.getElementById('slotsSupportBtn').addEventListener('click', function () {
                window.open('https://t.me/suphiex', '_blank');
                vibrate([50]);
            });

            document.getElementById('slotsDepositBtn').addEventListener('click', function () {
                switchGame('deposit');
            });

            document.getElementById('slotsWithdrawBtn').addEventListener('click', function () {
                document.getElementById('withdrawModal').classList.add('show');
                document.getElementById('overlayDim').classList.add('show');
                vibrate([50]);
            });
        }

        // IMPROVED PLINKO GAME IMPLEMENTATION (keeping original)
        let plinkoInitialized = false;
        function initPlinkoGame() {
            if (plinkoInitialized) return;
            plinkoInitialized = true;

            let plinkoState = {
                isDropping: false,
                balls: [],
                gamesPlayed: 0,
                totalWin: 0,
                physics: {
                    gravity: 0.15,  // Уменьшенная гравитация для более плавного падения
                    bounce: 0.6,    // Естественный отскок
                    friction: 0.99  // Легкое трение
                },
                pegs: []
            };

            const multipliers = [
                { value: 100, weight: 0.0001 },    // 0.01%
                { value: 20, weight: 0.0049 },     // 0.49%
                { value: 5, weight: 0.015 },       // 1.5%
                { value: 2, weight: 0.03 },        // 3%
                { value: 1.5, weight: 0.05 },      // 5%
                { value: 1, weight: 0.15 },        // 15%
                { value: 0.5, weight: 0.75 }       // 75%
            ];

            // Улучшенная установка пинов (БЕЗ 3 ПОСЛЕДНИХ РЯДОВ)
            function setupPegs() {
                const board = document.getElementById('plinkoBoard');
                plinkoState.pegs = [];
                
                const rows = 11; // Уменьшено с 14 до 11 (убрано 3 ряда)
                const startY = 100;
                const rowHeight = 26;
                const boardWidth = board.offsetWidth;
                
                for (let row = 0; row < rows; row++) {
                    const pegsInRow = row + 3;
                    const spacing = (boardWidth - 40) / (pegsInRow + 1);
                    const y = startY + row * rowHeight;
                    
                    for (let col = 0; col < pegsInRow; col++) {
                        const x = 20 + spacing * (col + 1);
                        
                        const peg = document.createElement('div');
                        peg.className = 'plinko-peg';
                        peg.style.left = `${x - 6}px`;
                        peg.style.top = `${y - 6}px`;
                        
                        board.appendChild(peg);
                        
                        plinkoState.pegs.push({
                            x: x,
                            y: y,
                            radius: 6,
                            element: peg
                        });
                    }
                }
            }
            
            // Установка ведер
            function setupBuckets() {
                const bucketsContainer = document.getElementById('plinkoBuckets');
                bucketsContainer.innerHTML = '';
                
                const visualMultipliers = [5, 2, 1.5, 1, 0.5, 1, 1.5, 2, 5];
                
                visualMultipliers.forEach((mult, index) => {
                    const bucket = document.createElement('div');
                    bucket.className = 'plinko-bucket';
                    bucket.textContent = `${mult}x`;
                    
                    if (mult >= 5) {
                        bucket.classList.add('high-multiplier');
                    } else if (mult >= 2) {
                        bucket.classList.add('medium-multiplier');
                    } else {
                        bucket.classList.add('low-multiplier');
                    }
                    
                    bucketsContainer.appendChild(bucket);
                });
            }

            // Взвешенный случайный выбор
            function getWeightedMultiplier() {
                const random = Math.random();
                let cumulativeWeight = 0;
                
                for (const mult of multipliers) {
                    cumulativeWeight += mult.weight;
                    if (random <= cumulativeWeight) {
                        return mult.value;
                    }
                }
                
                return 0.5;
            }
            
            // Улучшенный класс мяча с естественной физикой (УМЕНЬШЕННЫЙ РАЗМЕР)
            class Ball {
                constructor(x, y) {
                    this.x = x;
                    this.y = y;
                    this.vx = (Math.random() - 0.5) * 0.5; // Случайное начальное движение
                    this.vy = 0;
                    this.radius = 8; // Уменьшено с 10 до 8
                    this.element = this.createElement();
                    this.maxFallTime = 8000; // 8 секунд максимального времени падения
                    this.startTime = Date.now();
                    this.finished = false;
                    this.targetMultiplier = getWeightedMultiplier();
                    this.bias = (Math.random() - 0.5) * 0.2; // Легкий уклон в сторону цели
                }
                
                createElement() {
                    const ball = document.createElement('div');
                    ball.className = 'plinko-ball';
                    ball.style.left = `${this.x - this.radius}px`;
                    ball.style.top = `${this.y - this.radius}px`;
                    document.getElementById('plinkoBoard').appendChild(ball);
                    return ball;
                }
                
                update() {
                    if (this.finished) return null;
                    
                    const elapsed = Date.now() - this.startTime;
                    
                    // Проверка времени
                    if (elapsed > this.maxFallTime) {
                        return this.finishDrop();
                    }
                    
                    // Применяем гравитацию
                    this.vy += plinkoState.physics.gravity;
                    
                    // Добавляем легкий уклон к цели
                    this.vx += this.bias * 0.01;
                    
                    // Добавляем небольшие случайные изменения
                    this.vx += (Math.random() - 0.5) * 0.05;
                    
                    // Обновляем позицию
                    this.x += this.vx;
                    this.y += this.vy;
                    
                    // Проверка столкновений с пинами
                    plinkoState.pegs.forEach(peg => {
                        const dx = this.x - peg.x;
                        const dy = this.y - peg.y;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        
                        if (distance < this.radius + peg.radius) {
                            // Столкновение обнаружено
                            const angle = Math.atan2(dy, dx);
                            const targetX = peg.x + Math.cos(angle) * (peg.radius + this.radius);
                            const targetY = peg.y + Math.sin(angle) * (peg.radius + this.radius);
                            
                            this.x = targetX;
                            this.y = targetY;
                            
                            // Естественный отскок
                            const bounceStrength = plinkoState.physics.bounce;
                            const bounceX = Math.cos(angle) * bounceStrength;
                            const bounceY = Math.sin(angle) * bounceStrength;
                            
                            this.vx = bounceX * 0.8 + (Math.random() - 0.5) * 0.3;
                            this.vy = Math.abs(bounceY) * 0.6;
                            
                            // Применяем трение
                            this.vx *= plinkoState.physics.friction;
                            this.vy *= plinkoState.physics.friction;
                            
                            // Визуальная обратная связь
                            peg.element.style.transform = 'scale(1.2)';
                            setTimeout(() => {
                                peg.element.style.transform = 'scale(1)';
                            }, 150);
                            
                            vibrate([10]);
                        }
                    });
                    
                    // Границы
                    const boardWidth = document.getElementById('plinkoBoard').offsetWidth;
                    if (this.x - this.radius < 10) {
                        this.x = 10 + this.radius;
                        this.vx = Math.abs(this.vx) * 0.8;
                    }
                    if (this.x + this.radius > boardWidth - 10) {
                        this.x = boardWidth - 10 - this.radius;
                        this.vx = -Math.abs(this.vx) * 0.8;
                    }
                    
                    // Проверка достижения дна
                    if (this.y > 440) {
                        return this.finishDrop();
                    }
                    
                    // Обновляем визуальную позицию
                    this.element.style.left = `${this.x - this.radius}px`;
                    this.element.style.top = `${this.y - this.radius}px`;
                    
                    return null;
                }
                
                finishDrop() {
                    this.finished = true;
                    
                    // Визуальная обратная связь на ведре
                    const buckets = document.querySelectorAll('.plinko-bucket');
                    const boardWidth = document.getElementById('plinkoBoard').offsetWidth;
                    const bucketIndex = Math.floor((this.x / boardWidth) * buckets.length);
                    const targetBucket = buckets[Math.min(bucketIndex, buckets.length - 1)];
                    
                    if (targetBucket) {
                        targetBucket.classList.add('hit');
                        setTimeout(() => {
                            targetBucket.classList.remove('hit');
                        }, 500);
                    }
                    
                    // Удаляем мяч из DOM
                    setTimeout(() => {
                        this.element.remove();
                    }, 300);
                    
                    return this.targetMultiplier;
                }
            }
            
            // Функция сброса мяча
            function dropBall(betAmount, isGift = false) {
                const board = document.getElementById('plinkoBoard');
                const startX = board.offsetWidth / 2;
                const startY = 70;
                
                const ball = new Ball(startX, startY);
                plinkoState.balls.push(ball);
                
                // Физическая симуляция
                const animate = () => {
                    if (plinkoState.balls.length === 0) return;
                    
                    for (let i = plinkoState.balls.length - 1; i >= 0; i--) {
                        const ball = plinkoState.balls[i];
                        const multiplier = ball.update();
                        
                        if (multiplier !== null) {
                            // Мяч закончил падение
                            plinkoState.balls.splice(i, 1);
                            
                            // Расчет выигрыша
                            const winAmount = betAmount * multiplier;
                            balance += winAmount;
                            updateBalance();
                            
                            // Обновляем статистику
                            plinkoState.gamesPlayed++;
                            plinkoState.totalWin += winAmount;
                            updatePlinkoStats();
                            
                            // Добавляем в историю ставок
                            addBetToHistory('Plinko', betAmount, winAmount, multiplier);
                            
                            // Показываем результат
                            setTimeout(() => {
                                const resultModal = document.getElementById('resultModal');
                                const resultAmount = document.getElementById('resultAmount');
                                
                                resultAmount.className = 'result-amount win';
                                resultAmount.innerHTML = `+${winAmount.toFixed(2)} TON (${multiplier}x)`;
                                
                                resultModal.classList.add('show');
                                document.getElementById('overlayDim').classList.add('show');
                                
                                // Вибрация в зависимости от множителя
                                if (multiplier >= 50) {
                                    vibrate([100, 50, 100, 50, 200, 50, 300]);
                                } else if (multiplier >= 10) {
                                    vibrate([50, 50, 100, 50, 150]);
                                } else {
                                    vibrate([50, 30, 80]);
                                }
                            }, 500);
                            
                            // Разблокируем кнопку
                            plinkoState.isDropping = false;
                            document.getElementById('plinkoDropBtn').disabled = false;
                            document.getElementById('plinkoDropBtn').textContent = 'БРОСИТЬ ШАРИК';
                            
                            saveGameData();
                        }
                    }
                    
                    if (plinkoState.balls.length > 0) {
                        requestAnimationFrame(animate);
                    }
                };
                
                requestAnimationFrame(animate);
            }
            
            // Обновление статистики
            function updatePlinkoStats() {
                document.getElementById('plinkoGamesPlayed').textContent = plinkoState.gamesPlayed;
                document.getElementById('plinkoTotalWin').textContent = `${plinkoState.totalWin.toFixed(2)} TON`;
            }

            // PLINKO TAB SWITCHING
            window.switchPlinkoTab = function (tab) {
                if (tab === 'ton') {
                    document.getElementById('plinkoTonTab').classList.add('active');
                    document.getElementById('plinkoInventoryTab').classList.remove('active');
                    document.getElementById('plinkoTonContent').style.display = 'block';
                    document.getElementById('plinkoInventoryContent').style.display = 'none';
                } else {
                    document.getElementById('plinkoTonTab').classList.remove('active');
                    document.getElementById('plinkoInventoryTab').classList.add('active');
                    document.getElementById('plinkoTonContent').style.display = 'none';
                    document.getElementById('plinkoInventoryContent').style.display = 'block';
                    updatePlinkoInventoryDisplay();
                }
                vibrate([30]);
            };

            function updatePlinkoInventoryDisplay() {
                const grid = document.getElementById('plinkoInventoryGrid');
                const placeholder = document.getElementById('plinkoInventoryPlaceholder');

                if (!grid || !placeholder) return;

                if (inventory.length === 0) {
                    placeholder.style.display = 'block';
                    grid.style.display = 'none';
                } else {
                    placeholder.style.display = 'none';
                    grid.style.display = 'grid';

                    grid.innerHTML = '';
                    inventory.forEach((item, index) => {
                        const div = document.createElement('div');
                        div.className = 'gift-item';
                        div.innerHTML = `
                            <img src="${item.image}" alt="Gift">
                            <div class="gift-value">
                                ${item.amount.toFixed(2)} <img src="https://ton.app/assets/images/what-is-ton/ton-logo.png" alt="TON" class="ton-logo">
                            </div>
                        `;
                        div.onclick = () => selectPlinkoGift(index);
                        grid.appendChild(div);
                    });
                }
            }

            function selectPlinkoGift(index) {
                selectedPlinkoGift = index;
                const items = document.querySelectorAll('#plinkoInventoryGrid .gift-item');
                items.forEach((item, i) => {
                    if (i === index) {
                        item.classList.add('selected');
                    } else {
                        item.classList.remove('selected');
                    }
                });
                vibrate([40]);
            }
            
            // Инициализация
            setupPegs();
            setupBuckets();
            
            // Обработчики событий
            document.getElementById('plinkoDropBtn').addEventListener('click', function() {
                if (plinkoState.isDropping) return;
                
                const isInventoryTab = document.getElementById('plinkoInventoryTab').classList.contains('active');
                
                if (isInventoryTab) {
                    // Ставка подарком
                    if (selectedPlinkoGift === null) {
                        alert('Выберите подарок из инвентаря!');
                        vibrate([100, 50, 100]);
                        return;
                    }
                    
                    const gift = inventory[selectedPlinkoGift];
                    if (gift.amount > 50) {
                        alert('Максимальная ставка: 50 TON');
                        vibrate([100, 50, 100]);
                        return;
                    }
                    
                    inventory.splice(selectedPlinkoGift, 1);
                    selectedPlinkoGift = null;
                    updatePlinkoInventoryDisplay();
                    
                    plinkoState.isDropping = true;
                    this.disabled = true;
                    this.textContent = 'ПАДАЕТ...';
                    
                    vibrate([80, 40, 120]);
                    dropBall(gift.amount, true);
                    
                } else {
                    // Ставка TON
                    const betAmount = parseFloat(document.getElementById('plinkoBetInput').value);
                    if (!betAmount || betAmount <= 0) {
                        alert('Введите корректную ставку!');
                        vibrate([100, 50, 100]);
                        return;
                    }
                    if (betAmount > 50) {
                        alert('Максимальная ставка: 50 TON');
                        vibrate([100, 50, 100]);
                        return;
                    }
                    if (betAmount > balance) {
                        alert('Недостаточно средств!');
                        vibrate([100, 50, 100]);
                        return;
                    }
                    
                    balance -= betAmount;
                    updateBalance();
                    
                    plinkoState.isDropping = true;
                    this.disabled = true;
                    this.textContent = 'ПАДАЕТ...';
                    
                    vibrate([80, 40, 120]);
                    dropBall(betAmount);
                }
            });
            
            // Быстрые ставки
            document.querySelectorAll('.plinko-quick-bet').forEach(btn => {
                btn.addEventListener('click', function() {
                    const amount = this.dataset.amount;
                    const input = document.getElementById('plinkoBetInput');
                    
                    if (amount === 'all') {
                        input.value = Math.min(balance, 50).toFixed(2);
                    } else {
                        input.value = amount;
                    }
                    vibrate([40]);
                });
            });
            
            // Загрузка сохраненной статистики
            const saved = localStorage.getItem('plinkoStats');
            if (saved) {
                const stats = JSON.parse(saved);
                plinkoState.gamesPlayed = stats.gamesPlayed || 0;
                plinkoState.totalWin = stats.totalWin || 0;
                updatePlinkoStats();
            }
            
            // Сохранение статистики
            const originalSaveGameData = saveGameData;
            saveGameData = function() {
                localStorage.setItem('plinkoStats', JSON.stringify({
                    gamesPlayed: plinkoState.gamesPlayed,
                    totalWin: plinkoState.totalWin
                }));
                originalSaveGameData.call(this);
            };
        }

        // DEPOSIT IMPLEMENTATION (keeping original)
        function initDepositGame() {
            let currentCurrency = 'rub';
            let sbpAmount = 0;
            let tonAmount = 0;
            const TON_RATE = 160;
            const COMMISSION = 0.05;

            document.getElementById('cryptoBotBtn').addEventListener('click', function () {
                document.getElementById('cryptoBotModal').classList.add('show');
                document.getElementById('overlayDim').classList.add('show');
                vibrate([40]);
            });

            document.getElementById('cryptoBotPay').addEventListener('click', function () {
                const amount = parseFloat(document.getElementById('cryptoBotAmount').value);
                if (!amount || amount <= 0) {
                    alert('Введите корректную сумму!');
                    vibrate([100, 50, 100]);
                    return;
                }

                hasDeposited = true;
                saveGameData();

                const url = `https://t.me/send?start=IV3tb3ybPkhw&text=Пополнение ${amount.toFixed(2)} TON для @${username}`;
                window.open(url, '_blank');

                closeAllModals();
                vibrate([100, 50, 150]);
            });

            document.getElementById('sbpBtn').addEventListener('click', function () {
                document.getElementById('sbpModal').classList.add('show');
                document.getElementById('overlayDim').classList.add('show');
                vibrate([40]);
            });

            document.querySelectorAll('.currency-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    document.querySelectorAll('.currency-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentCurrency = this.dataset.currency;
                    updateConversion();
                    vibrate([40]);
                });
            });

            document.getElementById('sbpAmount').addEventListener('input', updateConversion);

            function updateConversion() {
                const input = document.getElementById('sbpAmount');
                const conversionInfo = document.getElementById('conversionInfo');
                const amount = parseFloat(input.value) || 0;

                if (currentCurrency === 'rub') {
                    sbpAmount = amount;
                    const withCommission = amount * (1 + COMMISSION);
                    tonAmount = withCommission / TON_RATE;
                    conversionInfo.textContent = `К получению: ${tonAmount.toFixed(4)} TON (включая комиссию 5%)`;
                    input.placeholder = 'Сумма в рублях (200-5000)';
                } else {
                    tonAmount = amount;
                    sbpAmount = amount * TON_RATE * (1 + COMMISSION);
                    conversionInfo.textContent = `К оплате: ${sbpAmount.toFixed(2)} RUB (включая комиссию 5%)`;
                    input.placeholder = 'Сумма в TON';
                }
            }

            document.getElementById('sbpNext').addEventListener('click', function () {
                const amount = parseFloat(document.getElementById('sbpAmount').value);
                if (!amount || amount <= 0) {
                    alert('Введите корректную сумму!');
                    vibrate([100, 50, 100]);
                    return;
                }

                if (currentCurrency === 'rub' && (amount < 200 || amount > 5000)) {
                    alert('Сумма должна быть от 200 до 5000 рублей!');
                    vibrate([100, 50, 100]);
                    return;
                }

                updateConversion();

                document.getElementById('paymentAmount').textContent = `${sbpAmount.toFixed(2)} RUB`;
                document.getElementById('receiveAmount').textContent = `${tonAmount.toFixed(4)} TON`;

                document.getElementById('sbpModal').classList.remove('show');
                document.getElementById('sbpPaymentModal').classList.add('show');

                setupPaymentButton();
                vibrate([50, 30, 80]);
            });

            function setupPaymentButton() {
                const timerBtn = document.getElementById('continueTimer');
                
                timerBtn.textContent = 'Продолжить';
                timerBtn.classList.remove('ready');
                timerBtn.disabled = true;

                setTimeout(() => {
                    timerBtn.classList.add('ready');
                    timerBtn.disabled = false;

                    timerBtn.onclick = function () {
                        hasDeposited = true;
                        balance += tonAmount;
                        updateBalance();

                        // Добавляем в историю пополнений
                        depositHistory.unshift({
                            amount: tonAmount,
                            method: 'СБП',
                            date: new Date().toLocaleString('ru-RU')
                        });

                        closeAllModals();

                        alert(`Баланс пополнен на ${tonAmount.toFixed(4)} TON`);

                        document.getElementById('sbpAmount').value = '';
                        document.getElementById('conversionInfo').textContent = '';
                        
                        vibrate([100, 50, 100, 50, 200]);
                    };
                }, 180000);
            }

            document.getElementById('giftBtn').addEventListener('click', function () {
                document.getElementById('giftModal').classList.add('show');
                document.getElementById('overlayDim').classList.add('show');
                vibrate([40]);
            });

            const mainPromoInput = document.getElementById('mainPromoInput');
            if (mainPromoInput) {
                mainPromoInput.addEventListener('keypress', function (e) {
                    if (e.key === 'Enter') {
                        handlePromoCode(this.value.trim(), this);
                    }
                });
            }
        }

        // Utility Functions
        function copyToClipboard(text) {
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text).then(() => {
                    alert('Скопировано в буфер обмена');
                    vibrate([50]);
                });
            } else {
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    alert('Скопировано в буфер обмена');
                    vibrate([50]);
                } catch (err) {
                    alert('Не удалось скопировать');
                }
                document.body.removeChild(textArea);
            }
        }

        function closeAllModals() {
            document.querySelectorAll('.modal, .withdraw-modal, .result-modal, .history-modal').forEach(modal => {
                modal.classList.remove('show');
            });
            document.getElementById('rouletteBetPanel').classList.remove('show');
            document.getElementById('overlayDim').classList.remove('show');
            document.getElementById('rouletteOverlay').classList.remove('show');
            document.getElementById('qrFullscreenModal').classList.remove('show');
        }

        window.closeResultModal = function () {
            document.getElementById('resultModal').classList.remove('show');
            document.getElementById('overlayDim').classList.remove('show');
        };

        document.getElementById('overlayDim').addEventListener('click', function (e) {
            if (e.target === this) {
                closeAllModals();
            }
        });

        const firebaseConfig = {
            apiKey: "AIzaSyD5J4jYkIPKu77wPmB9IhFMeKf1hBS7Cvs",
            authDomain: "ton-game-app.firebaseapp.com",
            databaseURL: "https://ton-game-app-default-rtdb.firebaseio.com",
            projectId: "ton-game-app",
            storageBucket: "ton-game-app.firebasestorage.app",
            messagingSenderId: "1057469053210",
            appId: "1:1057469053210:web:811fa4e8ea33572e0c54a3"
        };
            if (!firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
            } else {
                firebase.app(); 
            }
            const db = firebase.database();

        document.addEventListener('DOMContentLoaded', function () {
            const tg = window.Telegram.WebApp;
            tg.expand();

            const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
                manifestUrl: 'https://zxcymf.github.io/ton-game/tonconnect-manifest.json',
                buttonRootId: 'ton-connect-button'
            });

            document.addEventListener('click', function(e) {
                if (e.target.matches('button, .vibrate-click, .game-tab, .tab, input[type="number"], input[type="text"]')) {
                    vibrate([40, 20, 60]);
                }
            });

            const user = tg.initDataUnsafe.user;
            const modal = document.getElementById('nicknameModal');
            const display = document.getElementById('profileUsername');

            window.saveBalanceToDB = function() {
                if (user) {
                    db.ref('users/' + user.id).update({ balance: balance });
                }
            };

            if (user) {
                username = user.username ? '@' + user.username : user.first_name;
                const userRef = db.ref('users/' + user.id);
                
                userRef.once('value', (snapshot) => {
                    if (snapshot.exists()) {
                        const data = snapshot.val();
                        balance = data.balance || 0.10;
                    } else {
                        userRef.set({
                            username: username,
                            balance: 0.10,
                            lastLogin: new Date().toISOString()
                        });
                        balance = 0.10;
                    }
                    if(display) display.textContent = username;
                    if(modal) modal.style.display = 'none';
                    updateBalanceDisplay();
                });
            } else {
                loadGameData(); 
            }

            document.getElementById('nicknameSubmit').addEventListener('click', submitNickname);
            document.getElementById('nicknameInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') submitNickname();
            });

            document.getElementById('profileDepositBtn').addEventListener('click', function() {
                const container = document.querySelector('.deposit-container');
                if (container) container.scrollIntoView({ behavior: 'smooth' });
                vibrate([50]);
            });

            document.getElementById('profileWithdrawBtn').addEventListener('click', function() {
                document.getElementById('withdrawModal').classList.add('show');
                document.getElementById('overlayDim').classList.add('show');
            });

            document.getElementById('profileSupportBtn').addEventListener('click', function() {
                window.open('https://t.me/suphiex', '_blank');
            });

            document.getElementById('withdrawSubmit').addEventListener('click', function() {
                const amount = parseFloat(document.getElementById('withdrawAmount').value);
                if (!hasDeposited) {
                    alert('Для вывода необходим депозит от 0.5$');
                    vibrate([200, 100, 200]);
                    return;
                }
                if (!amount || amount < 5) {
                    alert('Минимальный вывод: 5.00 TON');
                    return;
                }
                const url = `https://t.me/send?start=IV3tb3ybPkhw&text=Вывод ${amount.toFixed(2)} TON для @${username}`;
                window.open(url, '_blank');
                closeAllModals();
            });

            document.querySelectorAll('.game-tab').forEach(tab => {
                tab.addEventListener('click', function () {
                    switchGame(this.dataset.game);
                });
            });

            if(document.getElementById('backgroundToggleBtn')) {
                document.getElementById('backgroundToggleBtn').addEventListener('click', toggleCrashBackground);
            }

            setTimeout(() => {
                const loadingScreen = document.getElementById('loadingScreen');
                if(loadingScreen) loadingScreen.classList.add('hidden');
                
                if (!user && !initNicknameAuth()) {
                    if(modal) modal.classList.remove('hidden');
                } else {
                    initializeGame(currentGame);
                    document.querySelectorAll('.game-tab').forEach(t => t.classList.remove('active'));
                    const activeTab = document.querySelector(`[data-game="${currentGame}"]`);
                    if(activeTab) activeTab.classList.add('active');
                    
                    if (isStarryBackground) {
                        const gw = document.getElementById('gameWindow');
                        if(gw) gw.classList.add('starry');
                        if(typeof createStars === 'function') createStars();
                    }
                }
                if(typeof initDepositGame === 'function') initDepositGame();
            }, 3000);
        });
    </script>
</body>
</html>